<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/bootstrap-icons-1.5.0/bootstrap-icons.css"><link rel="stylesheet" href="/css/highlight.github-dark-dimmed.min.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/css/customthemes.css"><meta property="og:title" content="Computing website metrics using GitHub Actions - Luis Quintanilla"><meta property="og:type" content="website"><meta property="og:image" content="https://www.luisquintanilla.me/avatar.png"><meta property="og:image:secure_url" content="https://www.luisquintanilla.me/avatar.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="200"><meta property="og:image:height" content="200"><meta property="og:site_name" content="Luis Quintanilla Personal Website"><meta property="og:locale" content="en_US"><meta property="twitter:image" content="https://www.luisquintanilla.me/avatar.png"><meta property="fediverse:creator" content="@lqdev@toot.lqdev.tech"><link rel="alternate" type="application/rss+xml" title="Luis Quintanilla Blog RSS Feed" href="/blog.rss"><link rel="alternate" type="application/rss+xml" title="Luis Quintanilla Microblog RSS Feed" href="/microblog.rss"><link rel="alternate" type="application/rss+xml" title="Luis Quintanilla Response RSS Feed" href="/responses.rss"><link rel="webmention" title="Luis Quintanilla Webmention Endpoint" href="https://webmentions.lqdev.tech/api/inbox"><link rel="feeds" type="text/xml" title="Luis Quintanilla&#39;s Feeds" href="/feed/index.opml"><link rel="blogroll" type="text/xml" title="Luis Quintanilla&#39;s Blogroll" href="/feed/blogroll/index.opml"><link rel="podroll" type="text/xml" title="Luis Quintanilla&#39;s Podroll" href="/feed/podroll/index.opml"><link rel="youtuberoll" type="text/xml" title="Luis Quintanilla&#39;s YouTube Roll" href="/feed/youtube/index.opml"><meta name="robots" content="nosnippet"><title>Computing website metrics using GitHub Actions - Luis Quintanilla</title></head><body><nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark"><a class="navbar-brand" href="/"><img src="/avatar.png" height="32" width="32" class="d-inline-block align-top rounded-circle" style="margin-right:5px" loading="lazy">Luis Quintanilla</a><button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarCollapse"><ul class="navbar-nav mr-auto"><li class="nav-item active"><a class="nav-link" href="/">Home</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" id="aboutDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About</a><div class="dropdown-menu" aria-labelledby="aboutDropdown"><a class="dropdown-item" href="/about">Profile</a><a class="dropdown-item" href="/contact">Contact</a><a class="dropdown-item" href="/uses">Uses</a><a class="dropdown-item" href="/colophon">Colophon</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" id="feedDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Feeds</a><div class="dropdown-menu" aria-labelledby="feedDropdown"><a class="dropdown-item" href="/feed">Main</a><a class="dropdown-item" href="/feed/responses">Responses</a><a class="dropdown-item" href="/posts/1">Blog</a><div class="dropdown-divider"></div><a class="dropdown-item" href="/subscribe">Subscribe</a><div class="dropdown-divider"></div><a class="dropdown-item" href="/feed/starter">Starter Packs</a><div class="dropdown-divider"></div><a class="dropdown-item" href="/feed/blogroll">Blogroll</a><a class="dropdown-item" href="/feed/podroll">Podroll</a><a class="dropdown-item" href="/feed/forums">Forums</a><a class="dropdown-item" href="/feed/youtube">YouTube</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" id="collectionDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Collections</a><div class="dropdown-menu" aria-labelledby="collectionDropdown"><a class="dropdown-item" href="/radio">Radio</a><a class="dropdown-item" href="/library">Books</a><a class="dropdown-item" href="/tags">Tags</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" id="kbDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Knowledgebase</a><div class="dropdown-menu" aria-labelledby="kbDropdown"><a class="dropdown-item" href="/snippets">Snippets</a><a class="dropdown-item" href="/wiki">Wiki</a><a class="dropdown-item" href="/presentations">Presentations</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" id="liveDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Live</a><div class="dropdown-menu" aria-labelledby="liveDropdown"><a class="dropdown-item" href="/live">Stream</a><a class="dropdown-item" href="/streams">Recordings</a></div></li><li class="nav-item"><a class="nav-link" href="/events">Events</a></li></ul><a href="/subscribe"><svg class="bi bi-rss text-secondary" fill="currentColor" viewBox="0 0 16 16" height="32" width="32"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"></path><path d="M5.5 12a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm-3-8.5a1 1 0 0 1 1-1c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1-1-1zm0 4a1 1 0 0 1 1-1 6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1-1-1z"></path></svg></a></div></nav><main role="main" class="container"><div class="mr-auto"><h1>Computing website metrics using GitHub Actions</h1><h2>Introduction</h2>
<p>I recently posted my <a href="/feed/weblogging-rewind-2023">(We)blogging Rewind</a> and <a href="/feed/weblogging-rewind-2023-continued">(We)blogging Rewind Continued</a> for 2023. In these posts, I discuss some analysis I did of my posting behaviors over the past year on this website. I don't use platforms like Google Analytics to track visitors. I used to self-host a <a href="https://www.goatcounter.com/">GoatCounter</a> instance but personally I don't really care about traffic so I got rid of that. There are some standard reports I get from my <a href="https://learn.microsoft.com/azure/cdn/cdn-advanced-http-reports">CDN provider on Azure</a>, but again I don't really care about those metrics. What I do care about though is my output and understanding what I'm publishing and the topics that were important to me at any given time. In the case of those blog posts, it was for the year 2023. Given that I had already done the analysis and had written the script, I thought, why not automate it and run it on a more regular basis to have monthly summaries. Since my blog and scripts are already on GitHub, it makes sense to create a GitHub Action workflow. In this post, I discuss in more details what my post analytics script does and how I configured my workflow in GitHub Actions to run the script on the first of every month.</p>
<h2>The script</h2>
<p>This script loads the various posts on my website and computes aggregate metrics based on post types and their metadata. You can find the full script at <a href="/snippets/lqdev-me-website-post-metrics">stats.fsx</a>.</p>
<h3>Loading files</h3>
<p>The following are convenience functions which I use as part of my website build process.</p>
<p>In general these functions:</p>
<ul>
<li>Load the individual post files</li>
<li>Parse the content and YAML metadata</li>
</ul>
<pre><code class="language-fsharp">let posts = loadPosts()
let notes = loadFeed ()
let responses = loadReponses ()
</code></pre>
<p>Instead of building new custom functions, I can repurpose them and apply additional transformations to compute aggregate statistics.</p>
<h3>Computing aggregate statistics</h3>
<p>Once the posts are loaded, I apply transformations on the collections to compute aggregate metrics:</p>
<h4>Annual post counts</h4>
<p>The following are annual aggreagates of blog posts, notes, and responses.</p>
<h5>Blog posts</h5>
<p>Takes the blog post collection, parses the published date, and computes counts by the year property. Then, it sorts them in descending order.</p>
<pre><code class="language-fsharp">let postCountsByYear = 
    posts
    |&gt; Array.countBy (fun (x:Post) -&gt; DateTime.Parse(x.Metadata.Date) |&gt; _.Year)
    |&gt; Array.sortByDescending fst 
</code></pre>
<h5>Notes</h5>
<p>Takes the note collection, parses the published date, and computes counts by the year property. Then, it sorts them in descending order.</p>
<pre><code class="language-fsharp">let noteCountsByYear = 
    notes
    |&gt; Array.countBy (fun (x:Post) -&gt; DateTime.Parse(x.Metadata.Date) |&gt; _.Year)
    |&gt; Array.sortByDescending fst
</code></pre>
<h5>Responses</h5>
<p>Takes the response collection, parses the published date, and computes counts by the year property. Then, it sorts them in descending order.</p>
<pre><code class="language-fsharp">let responseCountsByYear = 
    responses
    |&gt; Array.countBy (fun (x:Response) -&gt; DateTime.Parse(x.Metadata.DatePublished) |&gt; _.Year)
    |&gt; Array.sortByDescending fst
</code></pre>
<h4>Response counts by type</h4>
<p>Takes the response collection, parses the published date, filters it for the current year, and computes counts by the post type (reply, bookmark, reshare, star).</p>
<pre><code class="language-fsharp">let responsesByType = 
    responses
    |&gt; Array.filter(fun x -&gt; (DateTime.Parse(x.Metadata.DatePublished) |&gt; _.Year) = DateTime.UtcNow.Year)
    |&gt; Array.countBy(fun x -&gt; x.Metadata.ResponseType)
    |&gt; Array.sortByDescending(snd)
</code></pre>
<h4>Tag counts (responses)</h4>
<p>Takes the response collection, parses the published date, filters it for the current year, and computes counts by the tag name, and sorts in descending order using the count.</p>
<pre><code class="language-fsharp">let responsesByTag = 
    responses
    |&gt; Array.filter(fun x -&gt; (DateTime.Parse(x.Metadata.DatePublished) |&gt; _.Year) = DateTime.UtcNow.Year)
    |&gt; Array.collect(fun x -&gt; 
            match x.Metadata.Tags with
            | null -&gt; [|&quot;untagged&quot;|]
            | [||] -&gt; [|&quot;untagged&quot;|]
            | _ -&gt; x.Metadata.Tags
        )
    |&gt; Array.countBy(fun x -&gt; x)
    |&gt; Array.sortByDescending(snd)
</code></pre>
<h4>Domain counts (responses)</h4>
<p>Takes the response collection, parses the published date, filters it for the current year, and computes counts by the target URL host name, and sorts it in descending order using the count.</p>
<pre><code class="language-fsharp">let responsesByDomain = 
    responses
    |&gt; Array.filter(fun x -&gt; (DateTime.Parse(x.Metadata.DatePublished) |&gt; _.Year) = DateTime.UtcNow.Year)
    |&gt; Array.countBy(fun x -&gt; Uri(x.Metadata.TargetUrl).Host)
    |&gt; Array.sortByDescending(snd)
</code></pre>
<h3>Displaying counts</h3>
<p>Since the <code>countBy</code> function is the one used to compute the counts, this produces a tuple. The tuple though could be <code>string</code> or <code>int</code>. Therefore, I set the collection of entry counts to use a generic <code>'a</code> for the first item in the tuple. I'm also able to control using <code>n</code> whether to display the entire collection by using <code>-1</code> as input or a limit when <code>n &gt;= 0</code>.</p>
<pre><code class="language-fsharp">let printEntryCounts&lt;'a&gt; (title:string) (entryCounts:('a * int) array) (n:int) = 
    printfn $&quot;{title}&quot;

    match n with 
    | n when n = -1 -&gt; 
        entryCounts
        |&gt; Array.iter(fun x -&gt; printfn $&quot;{fst x} {snd x}&quot;)
        |&gt; fun _ -&gt; printfn $&quot;&quot;
    | n when n &gt;= 0 -&gt; 
        entryCounts
        |&gt; Array.take n
        |&gt; Array.iter(fun x -&gt; printfn $&quot;{fst x} {snd x}&quot;)
        |&gt; fun _ -&gt; printfn $&quot;&quot;
</code></pre>
<p>The result of running this script produces the following results:</p>
<pre><code class="language-text">Blogs
2023 5
2022 7

Notes
2023 34
2022 36

Responses
2023 216
2022 146

Response Types
bookmark 151
reshare 48
reply 10
star 7

Response Tags
ai 104
llm 42
untagged 41
opensource 31
internet 17

Domains
github.com 15
huggingface.co 11
arxiv.org 10
openai.com 6
www.theverge.com 4
</code></pre>
<h2>The workflow file</h2>
<p>The workflow file is a GitHub Actions workflow which you can find in my <a href="https://github.com/lqdev/luisquintanilla.me/blob/main/.github/workflows/stats.yml">website repo</a>.</p>
<h3>Triggers</h3>
<p>I don't really want the script to run every time I publish my website. Instead, I just want to have these aggregate values computed on a monthly basis. Optionally though, I'd like to be able to run ad-hoc reports and trigger this job manually.</p>
<p>The triggers in my workflow file look like the following:</p>
<pre><code class="language-yaml">schedule: 
  - cron: '30 0 1 * *'
workflow_dispatch: 
</code></pre>
<p>Using cron job syntax, I use the <code>schedule</code> trigger to configure the script to run at 12:30 AM on the 1st day of every month.</p>
<p>The <code>workflow_dispatch</code> trigger is there so I can manually trigger this job.</p>
<h2>Steps</h2>
<p>The steps in the workflow file are the following:</p>
<ul>
<li><p>Check out the repo</p>
<pre><code class="language-yaml">- uses: actions/checkout@v2
</code></pre>
</li>
<li><p>Install the .NET 8 SDK</p>
<pre><code class="language-yaml">- name: Setup .NET SDK 8.x
  uses: actions/setup-dotnet@v1.9.0
  with: 
    dotnet-version: '8.0.x'    
</code></pre>
</li>
<li><p>Restore dependencies</p>
<pre><code class="language-yaml">- name: Install dependencies
  run: dotnet restore    
</code></pre>
</li>
<li><p>Build the project</p>
<pre><code class="language-yaml">- name: Build project
  run: dotnet build --no-restore  
</code></pre>
</li>
<li><p>Run the script and display metrics</p>
<pre><code class="language-yaml">- name: Display Post Metrics
  run: dotnet fsi Scripts/stats.fsx
</code></pre>
</li>
</ul>
<h2>Conclusion</h2>
<p>If you have scripts that you run on a repo on a fairly regular basis, consider using GitHub Actions to automate the execution of these scripts. Happy coding!</p>
<hr /><div><script type="application/javascript">window.onload = function() { document.getElementById('webmention-target').value = window.location.href }</script><form action="https://webmentions.lqdev.tech/api/inbox" method="POST" enctype="application/x-www-form-urlencoded"><h5 class="text-center">Send me a <a href="/contact">message</a> or <a href="https://indieweb.org/webmentions">webmention</a></h5><div class="form-row justify-content-center"><div class="w-75"><input type="text" name="source" class="form-control" placeholder="Your URL (source)" /></div><div class="col-auto"><input type="submit" class="btn btn-primary" value="Send" /></div><input readonly class="form-control-plaintext" style="visibility:hidden" type="text" id="webmention-target" name="target" /></div></form></div></div></main><script src="/lib/jquery/jquery.slim.min.js"></script><script src="/lib/boostrap/bootstrap.min.js"></script><script src="/lib/highlight/highlight.min.js"></script><script src="/lib/highlight/highlight.fsharp.min.js"></script><script src="/lib/highlight/highlight.nix.min.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script type="application/javascript">mermaid.initialize({startOnLoad:true});</script><script type="application/javascript">hljs.initHighlightingOnLoad();</script></body><footer><a rel="me" href="https://toot.lqdev.tech/@lqdev"></a><a rel="me" href="https://github.com/lqdev"></a><a rel="me" href="https://twitter.com/ljquintanilla"></a><a rel="me" href="https://www.linkedin.com/in/lquintanilla01/"></a><a rel="me" href="mailto:lqdev@outlook.com"></a></footer></html>