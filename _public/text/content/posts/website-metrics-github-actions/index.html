<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="/text/assets/text-only.css"><meta name="description" content="Text-only accessible version of Luis Quintanilla&#39;s website"><meta name="robots" content="noindex, nofollow"><title>Computing website metrics using GitHub Actions - Text-Only Site</title></head><body><a href="#main-content" class="skip-link">Skip to main content</a><header role="banner"><h1><a href="/text/">Luis Quintanilla</a></h1><p>Text-Only Accessible Website</p></header><nav role="navigation" aria-label="Main navigation"><ul><li><a href="/text/">Home</a></li><li><a href="/text/about/">About</a></li><li><a href="/text/contact/">Contact</a></li><li><a href="/text/content/">All Content</a></li><li><a href="/text/feeds/">RSS Feeds</a></li><li><a href="/text/help/">Help</a></li></ul></nav><main role="main" id="main-content"><div><h1>Computing website metrics using GitHub Actions</h1><div class="content-meta"><div class="content-type">posts</div><time datetime="2023-12-24">December 24, 2023</time><p>Tags: github, cicd, website, blog, blogging, web, internet, fsharp, dotnet</p></div><p><a href="/text/">← Home</a> | <a href="/text/content/posts/">← All posts</a> | <a href="https://www.lqdev.me/posts/website-metrics-github-actions">View Full Version</a></p><div class="content"><h2>Introduction</h2>
<p>I recently posted my <a href="/notes/weblogging-rewind-2023/">(We)blogging Rewind</a> and <a href="/notes/weblogging-rewind-2023-continued">(We)blogging Rewind Continued</a> for 2023. In these posts, I discuss some analysis I did of my posting behaviors over the past year on this website. I don't use platforms like Google Analytics to track visitors. I used to self-host a <a href="https://www.goatcounter.com/">GoatCounter</a> instance but personally I don't really care about traffic so I got rid of that. There are some standard reports I get from my <a href="https://learn.microsoft.com/azure/cdn/cdn-advanced-http-reports">CDN provider on Azure</a>, but again I don't really care about those metrics. What I do care about though is my output and understanding what I'm publishing and the topics that were important to me at any given time. In the case of those blog posts, it was for the year 2023. Given that I had already done the analysis and had written the script, I thought, why not automate it and run it on a more regular basis to have monthly summaries. Since my blog and scripts are already on GitHub, it makes sense to create a GitHub Action workflow. In this post, I discuss in more details what my post analytics script does and how I configured my workflow in GitHub Actions to run the script on the first of every month.</p>
<h2>The script</h2>
<p>This script loads the various posts on my website and computes aggregate metrics based on post types and their metadata. You can find the full script at <a href="/resources/snippets/lqdev-me-website-post-metrics">stats.fsx</a>.</p>
<h3>Loading files</h3>
<p>The following are convenience functions which I use as part of my website build process.</p>
<p>In general these functions:</p>
<ul>
<li>Load the individual post files</li>
<li>Parse the content and YAML metadata</li>
</ul>
<pre><code class="language-fsharp">let posts = loadPosts()
let notes = loadFeed ()
let responses = loadReponses ()
</code></pre>
<p>Instead of building new custom functions, I can repurpose them and apply additional transformations to compute aggregate statistics.</p>
<h3>Computing aggregate statistics</h3>
<p>Once the posts are loaded, I apply transformations on the collections to compute aggregate metrics:</p>
<h4>Annual post counts</h4>
<p>The following are annual aggreagates of blog posts, notes, and responses.</p>
<h5>Blog posts</h5>
<p>Takes the blog post collection, parses the published date, and computes counts by the year property. Then, it sorts them in descending order.</p>
<pre><code class="language-fsharp">let postCountsByYear = 
    posts
    |&gt; Array.countBy (fun (x:Post) -&gt; DateTime.Parse(x.Metadata.Date) |&gt; _.Year)
    |&gt; Array.sortByDescending fst 
</code></pre>
<h5>Notes</h5>
<p>Takes the note collection, parses the published date, and computes counts by the year property. Then, it sorts them in descending order.</p>
<pre><code class="language-fsharp">let noteCountsByYear = 
    notes
    |&gt; Array.countBy (fun (x:Post) -&gt; DateTime.Parse(x.Metadata.Date) |&gt; _.Year)
    |&gt; Array.sortByDescending fst
</code></pre>
<h5>Responses</h5>
<p>Takes the response collection, parses the published date, and computes counts by the year property. Then, it sorts them in descending order.</p>
<pre><code class="language-fsharp">let responseCountsByYear = 
    responses
    |&gt; Array.countBy (fun (x:Response) -&gt; DateTime.Parse(x.Metadata.DatePublished) |&gt; _.Year)
    |&gt; Array.sortByDescending fst
</code></pre>
<h4>Response counts by type</h4>
<p>Takes the response collection, parses the published date, filters it for the current year, and computes counts by the post type (reply, bookmark, reshare, star).</p>
<pre><code class="language-fsharp">let responsesByType = 
    responses
    |&gt; Array.filter(fun x -&gt; (DateTime.Parse(x.Metadata.DatePublished) |&gt; _.Year) = DateTime.UtcNow.Year)
    |&gt; Array.countBy(fun x -&gt; x.Metadata.ResponseType)
    |&gt; Array.sortByDescending(snd)
</code></pre>
<h4>Tag counts (responses)</h4>
<p>Takes the response collection, parses the published date, filters it for the current year, and computes counts by the tag name, and sorts in descending order using the count.</p>
<pre><code class="language-fsharp">let responsesByTag = 
    responses
    |&gt; Array.filter(fun x -&gt; (DateTime.Parse(x.Metadata.DatePublished) |&gt; _.Year) = DateTime.UtcNow.Year)
    |&gt; Array.collect(fun x -&gt; 
            match x.Metadata.Tags with
            | null -&gt; [|&quot;untagged&quot;|]
            | [||] -&gt; [|&quot;untagged&quot;|]
            | _ -&gt; x.Metadata.Tags
        )
    |&gt; Array.countBy(fun x -&gt; x)
    |&gt; Array.sortByDescending(snd)
</code></pre>
<h4>Domain counts (responses)</h4>
<p>Takes the response collection, parses the published date, filters it for the current year, and computes counts by the target URL host name, and sorts it in descending order using the count.</p>
<pre><code class="language-fsharp">let responsesByDomain = 
    responses
    |&gt; Array.filter(fun x -&gt; (DateTime.Parse(x.Metadata.DatePublished) |&gt; _.Year) = DateTime.UtcNow.Year)
    |&gt; Array.countBy(fun x -&gt; Uri(x.Metadata.TargetUrl).Host)
    |&gt; Array.sortByDescending(snd)
</code></pre>
<h3>Displaying counts</h3>
<p>Since the <code>countBy</code> function is the one used to compute the counts, this produces a tuple. The tuple though could be <code>string</code> or <code>int</code>. Therefore, I set the collection of entry counts to use a generic <code>'a</code> for the first item in the tuple. I'm also able to control using <code>n</code> whether to display the entire collection by using <code>-1</code> as input or a limit when <code>n &gt;= 0</code>.</p>
<pre><code class="language-fsharp">let printEntryCounts&lt;'a&gt; (title:string) (entryCounts:('a * int) array) (n:int) = 
    printfn $&quot;{title}&quot;

    match n with 
    | n when n = -1 -&gt; 
        entryCounts
        |&gt; Array.iter(fun x -&gt; printfn $&quot;{fst x} {snd x}&quot;)
        |&gt; fun _ -&gt; printfn $&quot;&quot;
    | n when n &gt;= 0 -&gt; 
        entryCounts
        |&gt; Array.take n
        |&gt; Array.iter(fun x -&gt; printfn $&quot;{fst x} {snd x}&quot;)
        |&gt; fun _ -&gt; printfn $&quot;&quot;
</code></pre>
<p>The result of running this script produces the following results:</p>
<pre><code class="language-text">Blogs
2023 5
2022 7

Notes
2023 34
2022 36

Responses
2023 216
2022 146

Response Types
bookmark 151
reshare 48
reply 10
star 7

Response Tags
ai 104
llm 42
untagged 41
opensource 31
internet 17

Domains
github.com 15
huggingface.co 11
arxiv.org 10
openai.com 6
www.theverge.com 4
</code></pre>
<h2>The workflow file</h2>
<p>The workflow file is a GitHub Actions workflow which you can find in my <a href="https://github.com/lqdev/luisquintanilla.me/blob/main/.github/workflows/stats.yml">website repo</a>.</p>
<h3>Triggers</h3>
<p>I don't really want the script to run every time I publish my website. Instead, I just want to have these aggregate values computed on a monthly basis. Optionally though, I'd like to be able to run ad-hoc reports and trigger this job manually.</p>
<p>The triggers in my workflow file look like the following:</p>
<pre><code class="language-yaml">schedule: 
  - cron: '30 0 1 * *'
workflow_dispatch: 
</code></pre>
<p>Using cron job syntax, I use the <code>schedule</code> trigger to configure the script to run at 12:30 AM on the 1st day of every month.</p>
<p>The <code>workflow_dispatch</code> trigger is there so I can manually trigger this job.</p>
<h2>Steps</h2>
<p>The steps in the workflow file are the following:</p>
<ul>
<li><p>Check out the repo</p>
<pre><code class="language-yaml">- uses: actions/checkout@v2
</code></pre>
</li>
<li><p>Install the .NET 8 SDK</p>
<pre><code class="language-yaml">- name: Setup .NET SDK 8.x
  uses: actions/setup-dotnet@v1.9.0
  with: 
    dotnet-version: '8.0.x'    
</code></pre>
</li>
<li><p>Restore dependencies</p>
<pre><code class="language-yaml">- name: Install dependencies
  run: dotnet restore    
</code></pre>
</li>
<li><p>Build the project</p>
<pre><code class="language-yaml">- name: Build project
  run: dotnet build --no-restore  
</code></pre>
</li>
<li><p>Run the script and display metrics</p>
<pre><code class="language-yaml">- name: Display Post Metrics
  run: dotnet fsi Scripts/stats.fsx
</code></pre>
</li>
</ul>
<h2>Conclusion</h2>
<p>If you have scripts that you run on a repo on a fairly regular basis, consider using GitHub Actions to automate the execution of these scripts. Happy coding!</p>
</div></div></main><footer role="contentinfo"><hr><p><a href="/">Full Site</a> | <a href="/text/accessibility/">Accessibility</a></p></footer></body></html>