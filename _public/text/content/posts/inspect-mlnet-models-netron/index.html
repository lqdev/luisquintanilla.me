<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="/text/assets/text-only.css"><meta name="description" content="Text-only accessible version of Luis Quintanilla&#39;s website"><meta name="robots" content="noindex, nofollow"><title>Inspect ML.NET models with Netron - Text-Only Site</title></head><body><a href="#main-content" class="skip-link">Skip to main content</a><header role="banner"><h1><a href="/text/">Luis Quintanilla</a></h1><p>Text-Only Accessible Website</p></header><nav role="navigation" aria-label="Main navigation"><ul><li><a href="/text/">Home</a></li><li><a href="/text/about/">About</a></li><li><a href="/text/contact/">Contact</a></li><li><a href="/text/content/">All Content</a></li><li><a href="/text/feeds/">RSS Feeds</a></li><li><a href="/text/help/">Help</a></li></ul></nav><main role="main" id="main-content"><div><h1>Inspect ML.NET models with Netron</h1><div class="content-meta"><div class="content-type">posts</div><time datetime="2021-08-25">August 25, 2021</time><p>Tags: dotnet, machine learning, mlnet, netron, artificial intelligence, tooling</p></div><p><a href="/text/">← Home</a> | <a href="/text/content/posts/">← All posts</a> | <a href="https://www.lqdev.me/posts/inspect-mlnet-models-netron">View Full Version</a></p><div class="content"><h2>Introduction</h2>
<p>Once you've trained a machine learning model, you typically serialize it and save it to a file. This serialized file contains information such as the model inputs and output schema (names, data types), the transformations and algorithms used by the model,  weights / coefficients, hyperparameters, and all other sorts of information about the model. The model file is then embedded in an end-user application such as a web API which deserializes the contents of the file and uses the model to make predictions on new data.</p>
<p>How the model is serialized depends on the framework you use to train your model. To standardize model serialization and interoperability, you can use something like Open Neural Network Exchange (ONNX) to represent your models if supported by the framework you're using. That's beyond the scope of this post though.</p>
<p>Regardless of which framework or serialization format is used, if you were to open up the model file, the contents of the model file are often not human readable or difficult to interpret. When the person who trains the model is also putting it into production, they know the format input data needs to be in to make predictions. That's not often the case though. As a result, the people putting models into production need the ability to inspect a model to get a sense of how they need to collect and preprocess input data before making predictions. That's where Netron comes in. <a href="https://github.com/lutzroeder/Netron">Netron</a> is a &quot;visualizer for neural network, deep learning, and machine learning models&quot;. In this post, I'll show how you can use Netron to inspect ML.NET models and use that information to define the model input and output schemas.</p>
<h2>Inspecting an ML.NET model</h2>
<p>ML.NET models are typically serialized and saved to files with the <em>.zip</em> file extension. Using the <em>.zip</em> file extension is standard convention. However, the extension can be whatever makes the most sense to you.</p>
<p>A common question is, what's in the <em>zip</em> file? The easy but vague answer to that question is, a serialized version of the model. Using Netron, you can go deeper and see exactly what is inside the <em>zip</em> file.</p>
<p>In this post, I'm using a pretrained ML.NET model that classifies sentiment. The model can be found in the <a href="https://github.com/dotnet/samples/blob/main/machine-learning/models/sentimentanalysis/sentiment_model.zip">dotnet/samples</a> repo. The same concept applies to any other ML.NET model.</p>
<p>To inspect the ML.NET model using Netron:</p>
<ol>
<li><p><a href="https://github.com/dotnet/samples/raw/main/machine-learning/models/sentimentanalysis/sentiment_model.zip">Download the model</a></p>
</li>
<li><p>Navigate to <a href="https://netron.app/">https://netron.app</a>. Alternatively, if you'd prefer to use Netron offline, you can also <a href="https://github.com/lutzroeder/netron/releases">download the latest version of Netron</a> for your operating system (Windows, Mac, or Linux). In this post, I use the web app.</p>
</li>
<li><p>Select <strong>Open Model...</strong> and use the file browser to select your ML.NET model. In this case, our model is <em>sentiment_model.zip</em>.</p>
</li>
<li><p>After a few seconds, a graph describing you model appears. How long it takes for your model depends on its size. The larger your model, the longer it takes to load. The nodes in the graph represent the model inputs, transformations, algorithm, and outputs.</p>
</li>
<li><p>Usually the top nodes represent the model inputs and the last node represents the algorithm or trainer. Click on any of the top nodes to display more information about the inputs.</p>
<p><a href="https://user-images.githubusercontent.com/11130940/130704589-61ebb612-d65f-4364-b275-bd0d4991d3cf.png" target="_blank">[Image: Sentiment Classification ML.NET model in netron]</a></p>
<p>For this model, we see that there are 3 input properties or columns:</p>
<ul>
<li>SentimentText (string)</li>
<li>Label (boolean)</li>
<li>SamplingKeyColumn (float32)</li>
</ul>
<p>Using this information, we can represent the model inputs as a Plain-Old-CLR-Object (POCO) in our end-user application.</p>
<pre><code class="language-csharp">public class ModelInput
{
    public string SentimentText {get;set;}
    public bool Label {get;set;}
    public float SamplingKeyColumn {get;set;} 
}
</code></pre>
<p><a href="https://user-images.githubusercontent.com/11130940/130705880-0baea2f7-7b45-408a-b60c-16acceb54079.png" target="_blank">[Image: ML.NET Netron Binary Predictor]</a></p>
<p>Looking at the last node <code>BinaryPredXfer</code>, we see that the algorithm used is for binary classification or predictions. Looking at the <a href="https://docs.microsoft.com/dotnet/machine-learning/resources/tasks#binary-classification-inputs-and-outputs">ML.NET tasks documentation</a>, we expect to get at least two columns in the prediction output:</p>
<ul>
<li>Score (Single)</li>
<li>PredictedLabel (boolean)</li>
</ul>
<p>Like the input, we can also represent model outputs or predictions as follows:</p>
<pre><code class="language-csharp">public class ModelOutput
{
    public float Score {get;set;}
    public bool PredictedLabel {get;set;}
}
</code></pre>
<p>Keep in mind that the name of the class can be anything so long as the properties or column names and types match with those expected by the model.</p>
</li>
</ol>
<p>Once you have your model inputs and outputs defined in your end-user application, you can follow the standard process of <a href="https://docs.microsoft.com/dotnet/machine-learning/how-to-guides/machine-learning-model-predictions-ml-net">loading your model and using it to make predictions</a>.</p>
<h2>Conclusion</h2>
<p>Inspecting ML.NET models can be difficult since their serialized version is not human readable. When making predictions with ML.NET models but you're not familiar with what the input and output data should look like, use Netron to inspect the model. Then, use the information about the input data names and types, machine learning task, and algorithm to define model input and output schema classes in your end-user application. Once you've defined your model input and output, you can use the model to make predictions on new data.</p>
</div></div></main><footer role="contentinfo"><hr><p><a href="/">Full Site</a> | <a href="/text/accessibility/">Accessibility</a></p></footer></body></html>