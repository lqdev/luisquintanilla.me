<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link rel="stylesheet" href="/assets/css/custom/main.css"><link rel="stylesheet" href="/assets/css/custom/timeline.css"><link rel="stylesheet" href="/assets/css/bootstrap-icons-1.5.0/bootstrap-icons.css"><link rel="stylesheet" href="/assets/css/highlight.github-dark-dimmed.min.css"><link rel="stylesheet" href="/assets/css/main.css"><link rel="stylesheet" href="/lib/revealjs/dist/reveal.css"><link rel="stylesheet" href="/lib/revealjs/dist/theme/black.css"><link rel="stylesheet" href="/lib/revealjs/plugin/highlight/monokai.css"><meta property="og:title" content="Serverless Racket Applications Using Azure Functions Custom Handlers - Luis Quintanilla"><meta property="og:type" content="website"><meta property="og:image" content="https://www.lqdev.me/avatar.png"><meta property="og:image:secure_url" content="https://www.lqdev.me/avatar.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="200"><meta property="og:image:height" content="200"><meta property="og:site_name" content="Luis Quintanilla Personal Website"><meta property="og:locale" content="en_US"><meta property="twitter:image" content="https://www.lqdev.me/avatar.png"><meta property="fediverse:creator" content="@lqdev@toot.lqdev.tech"><link rel="alternate" type="application/rss+xml" title="Luis Quintanilla Blog RSS Feed" href="/blog.rss"><link rel="alternate" type="application/rss+xml" title="Luis Quintanilla Microblog RSS Feed" href="/microblog.rss"><link rel="alternate" type="application/rss+xml" title="Luis Quintanilla Response RSS Feed" href="/responses.rss"><link rel="webmention" title="Luis Quintanilla Webmention Endpoint" href="https://webmentions.lqdev.tech/api/inbox"><link rel="feeds" type="text/xml" title="Luis Quintanilla&#39;s Feeds" href="/feed/index.opml"><link rel="blogroll" type="text/xml" title="Luis Quintanilla&#39;s Blogroll" href="/collections/blogroll/index.opml"><link rel="podroll" type="text/xml" title="Luis Quintanilla&#39;s Podroll" href="/collections/podroll/index.opml"><link rel="youtuberoll" type="text/xml" title="Luis Quintanilla&#39;s YouTube Roll" href="/collections/youtube/index.opml"><meta name="robots" content="nosnippet"><title>Serverless Racket Applications Using Azure Functions Custom Handlers - Luis Quintanilla</title></head><body><button class="mobile-toggle" id="mobile-nav-toggle" aria-label="Toggle navigation menu" aria-expanded="false"><div class="hamburger"><span></span><span></span><span></span></div></button><div class="nav-overlay" id="nav-overlay"></div><nav class="desert-nav" id="sidebar-menu" role="navigation" aria-label="Main navigation"><div class="nav-brand"><a href="/" class="brand-text"><img src="/avatar.png" alt="Luis Quintanilla avatar" loading="lazy">Luis Quintanilla</a></div><div class="nav-section"><a class="nav-link" href="/"><svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L8.354 1.146zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4H2.5z"></path></svg>Home</a><a class="nav-link" href="/about"><svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"></path></svg>About</a><a class="nav-link" href="/contact"><svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z"></path></svg>Contact</a><a class="nav-link" href="/search"><svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"></path></svg>Search</a><a class="nav-link" href="/feed"><svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M5.5 12a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm-3-8.5a1 1 0 0 1 1-1c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1-1-1zm0 4a1 1 0 0 1 1-1 6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1-1-1z"></path></svg>Subscribe</a></div><div class="nav-section dropdown"><button class="nav-link dropdown-toggle" data-target="collections-dropdown"><svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M2.5 3A1.5 1.5 0 0 0 1 4.5v.793c.026.009.051.02.076.032L7.674 8.51c.206.1.446.1.652 0l6.598-3.185A.755.755 0 0 1 15 5.293V4.5A1.5 1.5 0 0 0 13.5 3h-11Z"></path><path d="M15 6.954 8.978 9.86a2.25 2.25 0 0 1-1.956 0L1 6.954V11.5A1.5 1.5 0 0 0 2.5 13h11a1.5 1.5 0 0 0 1.5-1.5V6.954Z"></path></svg>Collections<svg class="dropdown-arrow" viewBox="0 0 16 16" fill="currentColor"><path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"></path></svg></button><div class="dropdown-menu" id="collections-dropdown"><a class="dropdown-item" href="/collections/blogroll">Blogroll</a><a class="dropdown-item" href="/collections/podroll">Podroll</a><a class="dropdown-item" href="/collections/youtube">YouTube</a><a class="dropdown-item" href="/collections/forums">Forums</a><div class="dropdown-divider"></div><a class="dropdown-item" href="/collections/starter-packs">Starter Packs</a><div class="dropdown-divider"></div><a class="dropdown-item" href="/radio">Radio</a><a class="dropdown-item" href="/tags">Tags</a></div></div><div class="nav-section dropdown"><button class="nav-link dropdown-toggle" data-target="resources-dropdown"><svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z"></path></svg>Resources<svg class="dropdown-arrow" viewBox="0 0 16 16" fill="currentColor"><path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"></path></svg></button><div class="dropdown-menu" id="resources-dropdown"><a class="dropdown-item" href="/resources/snippets">Snippets</a><a class="dropdown-item" href="/resources/wiki">Wiki</a><a class="dropdown-item" href="/resources/presentations">Presentations</a></div></div><div class="theme-toggle"><button class="theme-toggle-btn" id="theme-toggle" aria-label="Toggle dark mode"><span id="theme-toggle-icon">☀️</span><span>Theme</span></button></div></nav><main role="main" class="main-content" id="main-content"><div class="content-wrapper"><div class="mr-auto"><article class="h-entry individual-post"><header class="post-header"><h1 class="p-name post-title">Serverless Racket Applications Using Azure Functions Custom Handlers</h1><div class="post-meta"><time class="dt-published" datetime="2020-03-21 13:45:43 -05:00">March 21, 2020</time></div><div class="u-author h-card microformat-hidden"><img src="/avatar.png" class="u-photo" alt="Luis Quintanilla" /><a href="/about" class="u-url p-name">Luis Quintanilla</a></div></header><div class="e-content post-content"><h2>Introduction</h2>
<p><a href="https://racket-lang.org/">Racket</a> is a fun and powerful general purpose programming language based on the Scheme dialect of Lisp that provides tools and packages that allow individuals to quickly be productive. Although you can build traditional web applications with it, it would be nice to use it with cloud-native technologies like serverless. Azure Functions is designed for these types of event-driven workflows but unfortunately does not officially support Racket. Recently, a new feature called custom handlers was announced which allows individuals to run web applications written in any language that supports HTTP primitives as an Azure Function. When I learned of this feature, my immediate thought was, challenge accepted!</p>
<p>Custom handlers require the following:</p>
<ol>
<li>Write a web server to process requests</li>
<li>Define the bindings for the request and response function payloads</li>
<li>Configure the Azure Functions host to send request to the web server</li>
</ol>
<p>In this writeup, I'll show how to set up a Racket web server that processes <code>GET</code> requests running as an Azure Function. The source code for this project can be found in the <a href="https://github.com/lqdev/RacketAzureFunctionsCustomHandlerSample">RacketAzureFunctionsCustomHandlerSample GitHub repository</a></p>
<h2>Prerequisites</h2>
<p>This project was built on a Windows 10 PC, but it should work cross-platform on Mac and Linux.</p>
<ul>
<li><a href="https://nodejs.org/en/">Node.js</a></li>
<li><a href="https://download.racket-lang.org/">Racket</a></li>
<li><a href="https://docs.microsoft.com/azure/azure-functions/functions-run-local">Azure Functions Core Tools</a>. This sample uses v2.x of the tool.</li>
</ul>
<h2>Create Azure Functions project</h2>
<p>Create a new directory called <code>RacketAzureFunctionsCustomHandlerSample</code> and navigate to it.</p>
<h2>Create Racket server</h2>
<p>The way Azure Functions custom handlers work is by having the Azure Functions host proxy requests to a web server written in the language of choice which processes the request and sends the response back to the Azure Functions host.</p>
<p>Start by setting the environment variable where Azure Functions and the server listen on. Create and environment variable called <code>FUNCTIONS_HTTPWORKER_PORT</code>. In this example, I set the variable to <code>7071</code>.</p>
<p>Inside of your application directory, create a file called <em>server.rkt</em> which will contain the server logic.</p>
<p>Open the <em>server.rkt</em> file. Define the language and import the required packages.</p>
<pre><code class="language-racket">#lang racket
(require json)
(require web-server/servlet)
(require web-server/servlet-env)
</code></pre>
<p>Then, get the port where the server listens on from the <code>FUNCTIONS_HTTPWORKER_PORT</code> environment variable.</p>
<pre><code class="language-racket">(define PORT (string-&gt;number (getenv &quot;FUNCTIONS_HTTPWORKER_PORT&quot;)))
</code></pre>
<p>Next, create a function called <code>get-values</code> to process your request. In this case, the function receives a <code>GET</code> request that returns a JSON object containing a list of integers.</p>
<pre><code class="language-racket">(define (get-values req)
    (response/full
        200
        #&quot;OK&quot;
        (current-seconds)
        #&quot;application/json;charset=utf-8&quot;
        empty
        (list (jsexpr-&gt;bytes #hasheq((value . (1 2 3)))))))
</code></pre>
<p>After that, define the routes so your server dispatches requests to the appropriate endpoint. In this case, <code>GET</code> requests to the <code>/values</code> endpoint are sent to and processed by the <code>get-values</code> function.</p>
<pre><code class="language-racket">(define-values (dispatch req)
    (dispatch-rules
        [(&quot;values&quot;) #:method &quot;get&quot; get-values]
        [else (error &quot;Route does not exist&quot;)]))
</code></pre>
<p>The final <em>server.rkt</em> file should contains content similar to the one below:</p>
<pre><code class="language-racket">;; Define language and import packages
#lang racket
(require json)
(require web-server/servlet)
(require web-server/servlet-env)

;; Get port where server listens on
(define PORT (string-&gt;number (getenv &quot;FUNCTIONS_HTTPWORKER_PORT&quot;)))

;; Create function to handle GET /values request
(define (get-values req)
    (response/full
        200
        #&quot;OK&quot;
        (current-seconds)
        #&quot;application/json;charset=utf-8&quot;
        empty
        (list (jsexpr-&gt;bytes #hasheq((value . (1 2 3)))))))

;; Define routes
(define-values (dispatch req)
    (dispatch-rules
        [(&quot;values&quot;) #:method &quot;get&quot; get-values]
        [else (error &quot;Route does not exist&quot;)]))

;; Define and start server
(serve/servlet
    (lambda (req) (dispatch req))
    #:launch-browser? #f
    #:quit? #f
    #:port PORT
    #:servlet-path &quot;/&quot;
    #:servlet-regexp #rx&quot;&quot;)
</code></pre>
<h2>Test the Racket server</h2>
<p>Start the server by running the following command:</p>
<pre><code class="language-bash">racket --require server.rkt
</code></pre>
<p>Then, using an application like Postman or Insomina, make a <code>GET</code> request to <code>http://localhost:7071/values</code>.</p>
<p>The response should look like the following:</p>
<pre><code class="language-json">{
    &quot;value&quot;: [
        1,
        2,
        3
    ]
}
</code></pre>
<h2>Define function bindings</h2>
<p>The way Azure Functions discovers functions is through subdirectories containing a binding definition called <em>function.json</em>. The name of the subdirectories must match the name of your function's route path. For example if the route path is <code>/values</code>, then the name of the subdirectory is  <code>values</code>.</p>
<p>Create a subdirectory inside the main application directory called <em>values</em></p>
<p>Inside the <em>values</em> subdirectory, create a file called <em>function.json</em> and add the following content to it.</p>
<pre><code class="language-json">{
    &quot;bindings&quot;: [
      {
        &quot;type&quot;: &quot;httpTrigger&quot;,
        &quot;direction&quot;: &quot;in&quot;,
        &quot;name&quot;: &quot;req&quot;,
        &quot;methods&quot;: [&quot;get&quot;]
      },
      {
        &quot;type&quot;: &quot;http&quot;,
        &quot;direction&quot;: &quot;out&quot;,
        &quot;name&quot;: &quot;res&quot;
      }
    ]
}
</code></pre>
<p>The <em>function.json</em> file defines the request and response payloads. In this case, the incoming request is an <code>HttpTrigger</code> that only handles <code>GET</code> requests and returns an HTTP response.</p>
<h2>Create server executable</h2>
<p>Package your server application into a single executable by entering the following command into the command prompt:</p>
<pre><code class="language-bash">raco exe server.rkt
</code></pre>
<p>Once your application is packaged, an executable with the name <em>server.exe</em> should be created in your application directory.</p>
<h2>Configure Azure Functions host</h2>
<p>In your application directory, create a file called <em>host.json</em> and add the following contents:</p>
<pre><code class="language-json">{
  &quot;version&quot;: &quot;2.0&quot;,
  &quot;httpWorker&quot;: {
      &quot;description&quot;: {
          &quot;defaultExecutablePath&quot;: &quot;server.exe&quot;
      }
  }
}
</code></pre>
<p>This <em>host.json</em> configuration file tells the Azure Functions host where to find the web server executable.</p>
<h2>Run the Azure Functions application</h2>
<p>Inside the root application directory, enter the following command into the command prompt.</p>
<pre><code class="language-bash">func start
</code></pre>
<p>Using an application like Postman or Insomnia, make a <code>GET</code> request to <code>localhost:7071/api/values</code>.</p>
<p>The response should look like the following:</p>
<pre><code class="language-json">{
    &quot;value&quot;: [
        1,
        2,
        3
    ]
}
</code></pre>
<h2>Conclusion</h2>
<p>In this writeup, I showed how to create a Racket serverless application that runs on Azure Functions by using custom handlers. Doing so requires you to:</p>
<ol>
<li>Write a web server to process requests</li>
<li>Define the bindings for the request and response function payloads</li>
<li>Configure the Azure Functions host to send request to the web server</li>
</ol>
<p>Although in this example, the server was written in Racket, the same process is applicable to other languages. Keep in mind that at the time of this writing, custom handlers are preview and may change. Happy coding!</p>
<h2>Resources</h2>
<ul>
<li><a href="https://docs.microsoft.com/azure/azure-functions/functions-custom-handlers">Azure Functions Custom Handlers</a></li>
</ul>
</div><footer class="post-footer"><div class="permalink-info">Permalink: <a class="u-url permalink-link" href="/posts/serverless-racket-azure-functions-custom-handlers/">/posts/serverless-racket-azure-functions-custom-handlers/</a></div><div><script type="application/javascript">window.onload = function() { document.getElementById('webmention-target').value = window.location.href }</script><form action="https://webmentions.lqdev.tech/api/inbox" method="POST" enctype="application/x-www-form-urlencoded"><h5 class="text-center">Send me a <a href="/contact">message</a> or <a href="https://indieweb.org/webmentions">webmention</a></h5><div class="form-row justify-content-center"><div class="w-75"><input type="url" class="form-control" name="source" placeholder="Your URL (webmention source)" required /></div><div class="col-auto"><input type="submit" class="btn btn-primary" value="Send" /></div><input type="hidden" readonly name="target" id="webmention-target" /></div></form></div></footer></article></div></div></main><script src="/assets/lib/jquery/jquery.slim.min.js"></script><script src="/assets/lib/boostrap/bootstrap.min.js"></script><script src="/assets/lib/highlight/highlight.min.js"></script><script src="/assets/lib/highlight/highlight.fsharp.min.js"></script><script src="/assets/lib/highlight/highlight.nix.min.js"></script><script src="/assets/js/timeline.js"></script><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script type="application/javascript">mermaid.initialize({startOnLoad:true});</script><script type="application/javascript">hljs.initHighlightingOnLoad();</script><script src="/lib/revealjs/dist/reveal.js"></script><script src="/lib/revealjs/plugin/markdown/markdown.js"></script><script src="/lib/revealjs/plugin/highlight/highlight.js"></script><script type="application/javascript">
                    // Initialize Reveal.js when a presentation container is found on the page
                    document.addEventListener('DOMContentLoaded', function() {
                        const presentationContainer = document.querySelector('.presentation-container');
                        if (presentationContainer && typeof Reveal !== 'undefined') {
                            Reveal.initialize({
                                plugins: [RevealMarkdown, RevealHighlight],
                                embedded: true
                            });
                        }
                    });
                    </script></body><footer><a rel="me" href="https://toot.lqdev.tech/@lqdev"></a><a rel="me" href="https://github.com/lqdev"></a><a rel="me" href="https://twitter.com/ljquintanilla"></a><a rel="me" href="https://www.linkedin.com/in/lquintanilla01/"></a><a rel="me" href="mailto:lqdev@outlook.com"></a></footer></html>