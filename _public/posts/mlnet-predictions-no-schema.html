<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><script async data-goatcounter="https://stats.luisquintanilla.me/count" src="//stats.luisquintanilla.me/count.js"></script><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/bootstrap-icons-1.5.0/bootstrap-icons.css"><link rel="stylesheet" href="/css/highlight-dark.min.css"><link rel="stylesheet" href="/css/main.css"><meta property="og:title" content="Make predictions with ML.NET models without defining schema classes - Luis Quintanilla"><meta property="og:type" content="website"><meta property="og:image" content="https://www.luisquintanilla.me/avatar.png"><meta property="og:image:secure_url" content="https://www.luisquintanilla.me/avatar.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="200"><meta property="og:image:height" content="200"><meta property="og:site_name" content="Luis Quintanilla Personal Website"><meta property="og:locale" content="en_US"><meta property="twitter:image" content="https://www.luisquintanilla.me/avatar.png"><link rel="alternate" type="application/rss+xml" title="Luis Quintanilla Blog RSS Feed" href="https://www.luisquintanilla.me/posts/index.xml"><link rel="alternate" type="application/rss+xml" title="Luis Quintanilla Main Feed (Microblog) RSS" href="https://www.luisquintanilla.me/feed/index.xml"><link rel="alternate" type="application/rss+xml" title="Luis Quintanilla Notes Feed RSS" href="https://www.luisquintanilla.me/feed/notes.xml"><link rel="alternate" type="application/rss+xml" title="Luis Quintanilla Photos Feed RSS" href="https://www.luisquintanilla.me/feed/photos.xml"><link rel="alternate" type="application/rss+xml" title="Luis Quintanilla Videos Feed RSS" href="https://www.luisquintanilla.me/feed/videos.xml"><meta name="robots" content="noindex,nofollow,nosnippet"><title>Make predictions with ML.NET models without defining schema classes - Luis Quintanilla</title></head><body><nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark"><a class="navbar-brand" href="/"><img src="/avatar.png" height="32" width="32" class="d-inline-block align-top rounded-circle" style="margin-right:5px">Luis Quintanilla</a><button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarCollapse"><ul class="navbar-nav mr-auto"><li class="nav-item active"><a class="nav-link" href="/">Home</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" id="aboutDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About</a><div class="dropdown-menu" aria-labelledby="aboutDropdown"><a class="dropdown-item" href="/about.html">About Me</a><a class="dropdown-item" href="/irl-stack.html">IRL Stack</a><a class="dropdown-item" href="/colophon.html">Colophon</a></div></li><li class="nav-item"><a class="nav-link" href="/contact.html">Contact</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" id="feedDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Feeds</a><div class="dropdown-menu" aria-labelledby="feedDropdown"><a class="dropdown-item" href="/feed/index.html">Main</a><a class="dropdown-item" href="/feed/notes.html">Notes</a><a class="dropdown-item" href="/feed/photos.html">Photos</a><a class="dropdown-item" href="/feed/videos.html">Videos</a><div class="dropdown-divider"></div><a class="dropdown-item" href="/feed/blogroll.html">Blogroll</a></div></li><li class="nav-item"><a class="nav-link" href="/posts/1">Blog</a></li><li class="nav-item"><a class="nav-link" href="/subscribe.html">Subscribe</a></li><li class="nav-item"><a class="nav-link" href="/events.html">Events</a></li><li class="nav-item"><a class="nav-link" href="/presentations.html">Presentations</a></li></ul><a href="/subscribe.html"><svg class="bi bi-rss text-secondary" fill="currentColor" viewBox="0 0 16 16" height="32" width="32"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"></path><path d="M5.5 12a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm-3-8.5a1 1 0 0 1 1-1c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1-1-1zm0 4a1 1 0 0 1 1-1 6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1-1-1z"></path></svg></a></div></nav><main role="main" class="container"><div class="mr-auto"><h2>Introduction</h2>
<p>To make predictions with ML.NET models you often have to define schema classes for your model inputs and outputs. In previous posts I wrote how you can <a href="inspect-mlnet-models-netron.html">use Netron to inspect an ML.NET model</a> to determine the name and types of your model inputs and outputs. If you have data samples of what your data input and output look like in JSON format, you can <a href="vs-automate-mlnet-schema-generation.html">automate the generation of model input and output classes by using Visual Studio's &quot;Paste JSON as Classes&quot; feature</a>. However, what if you want to make predictions without defining these classes? In this post I'll show how you can use the .NET DataFrame API to make predictions with ML.NET models without having to create model input and output classes. Code snippets are in F# but notebooks with complete <a href="https://github.com/lqdev/mlnet-noschema-predictions/blob/main/CSharp-NB.ipynb">C#</a> &amp; <a href="https://github.com/lqdev/mlnet-noschema-predictions/blob/main/FSharp-NB.ipynb">F#</a> code can be found in the <a href="https://github.com/lqdev/mlnet-noschema-predictions">mlnet-noschema-predictions repo</a> on GitHub.</p>
<h2>Install and reference packages</h2>
<p>In addition to the <a href="https://www.nuget.org/packages/Microsoft.ML/">Microsoft.ML</a> ML.NET NuGet package, you'll also need the <a href="https://www.nuget.org/packages/Microsoft.Data.Analysis/">Microsoft.Data.Analysis</a> NuGet package to use the .NET DataFrame API. For more information on the .NET DataFrame API, see <a href="https://devblogs.microsoft.com/dotnet/an-introduction-to-dataframe/">an introduction to DataFrame</a>.</p>
<p>Once your packages are installed, reference them in your application.</p>
<pre><code class="language-fsharp">open Microsoft.ML
open Microsoft.Data.Analysis
</code></pre>
<h2>Initialize MLContext and load the model</h2>
<p>The <code>MLContext</code> is the entrypoint of ML.NET applications. Use it to load your model. The model used in this case categorizes sentiment as positive or negative. See the <a href="inspect-mlnet-models-netron.html">use Netron to inspect an ML.NET model</a> blog post to learn more about the model.</p>
<pre><code class="language-fsharp">let ctx = MLContext()
let model,schema = ctx.Model.Load(&quot;sentiment_model.zip&quot;)
</code></pre>
<p>Both the model and the input schema are returned when you load the model. The input schema is a <a href="https://docs.microsoft.com/dotnet/api/microsoft.ml.dataviewschema?view=ml-dotnet">DataViewSchema</a> object containing a collection of <a href="https://docs.microsoft.com/dotnet/api/microsoft.ml.dataviewschema.column?view=ml-dotnet">Columns</a>.</p>
<h2>Define input and output column names</h2>
<p>The input and output column names are for the DataFrames containing your input data and predictions. They help the model map the input and output values.</p>
<p>Use the <code>schema</code> which was loaded with the model to get the name of your input columns.</p>
<pre><code class="language-fsharp">let inputColumnNames = 
    schema 
    |&gt; Seq.map(fun column -&gt; column.Name) 
    |&gt; Array.ofSeq
</code></pre>
<p>Since this is a binary classification model by default only two columns are returned as part of the prediction:</p>
<ul>
<li>Score</li>
<li>PredictedLabel</li>
</ul>
<p>You can create an array containing the names of these columns. For more information on default output columns, see the <a href="https://docs.microsoft.com/dotnet/machine-learning/resources/tasks#binary-classification-inputs-and-outputs">ML.NET Tasks documentation</a>.</p>
<pre><code class="language-fsharp">let outputColumnNames = [| &quot;PredictedLabel&quot; ; &quot;Score&quot; |]
</code></pre>
<h2>Create input data for predictions</h2>
<p>Use the <a href="https://docs.microsoft.com/dotnet/api/microsoft.data.analysis.dataframe.loadcsvfromstring?view=ml-dotnet-preview#Microsoft_Data_Analysis_DataFrame_LoadCsvFromString_System_String_System_Char_System_Boolean_System_String___System_Type___System_Int64_System_Int32_System_Boolean_"><code>LoadCsvFromString</code></a> method to load your input data into a DataFrame. In this case, there's only one column and data instance so I represent it as a string literal. Additionally, I provide the name of the input columns.</p>
<pre><code class="language-fsharp">let sampleInput = &quot;This was a very bad steak&quot;

let inputDataFrame = 
    DataFrame.LoadCsvFromString(
        sampleInput, 
        header=false, 
        columnNames=inputColumnNames)
</code></pre>
<h2>Make predictions</h2>
<p>Now that you've loaded your input data, it's time to use the model to make predictions.</p>
<pre><code class="language-fsharp">let predictionDV = 
    inputDataFrame 
    |&gt; model.Transform 
</code></pre>
<p>Calling the <a href="https://docs.microsoft.com/dotnet/api/microsoft.ml.itransformer.transform?view=ml-dotnet#Microsoft_ML_ITransformer_Transform_Microsoft_ML_IDataView_"><code>Transform</code></a> method  returns an <a href="https://docs.microsoft.com/dotnet/api/microsoft.ml.idataview?view=ml-dotnet"><code>IDataView</code></a> with your predictions. You can then convert the <code>IDataView</code> into a DataFrame for further processing with the <a href="https://docs.microsoft.com/dotnet/api/microsoft.ml.idataviewextensions.todataframe?view=ml-dotnet-preview"><code>ToDataFrame</code></a> method.</p>
<pre><code class="language-fsharp">let prediction = predictionDV.ToDataFrame(1L, outputColumnNames)
</code></pre>
<p>The resulting DataFrame should look something like the following:</p>
<p>| index | PredictedLabel | Score |
|---|---|---|
|0 |False | -2.1337974 |</p>
<h2>Conclusion</h2>
<p>If you want to load a model and make predictions without defining  classes for your input and output schema's you can load your data into a DataFrame using the .NET DataFrame API. While this solution works, because DataFrames and IDataViews process data differently, I haven't tested whether this solution would scale for larger data sets.</p>
</div></main><script src="/lib/jquery/jquery.slim.min.js"></script><script src="/lib/boostrap/bootstrap.min.js"></script><script src="/lib/highlight/highlight.min.js"></script><script src="/lib/highlight/highlight.fsharp.min.js"></script><script type="application/javascript">hljs.initHighlightingOnLoad();</script></body><footer><a rel="me" href="https://toot.lqdev.tech/@lqdev"></a></footer></html>