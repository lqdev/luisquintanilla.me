<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link rel="stylesheet" href="/assets/css/custom/main.css"><link rel="stylesheet" href="/assets/css/custom/timeline.css"><link rel="stylesheet" href="/assets/css/bootstrap-icons-1.5.0/bootstrap-icons.css"><link rel="stylesheet" href="/assets/css/highlight.github-dark-dimmed.min.css"><link rel="stylesheet" href="/assets/css/main.css"><link rel="stylesheet" href="/lib/revealjs/dist/reveal.css"><link rel="stylesheet" href="/lib/revealjs/dist/theme/black.css"><link rel="stylesheet" href="/lib/revealjs/plugin/highlight/monokai.css"><meta property="og:title" content="Deploy ML.NET Machine Learning Model in Blazor WebAssembly Static Website - Luis Quintanilla"><meta property="og:type" content="website"><meta property="og:image" content="https://www.lqdev.me/avatar.png"><meta property="og:image:secure_url" content="https://www.lqdev.me/avatar.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="200"><meta property="og:image:height" content="200"><meta property="og:site_name" content="Luis Quintanilla Personal Website"><meta property="og:locale" content="en_US"><meta property="twitter:image" content="https://www.lqdev.me/avatar.png"><meta property="fediverse:creator" content="@lqdev@toot.lqdev.tech"><link rel="alternate" type="application/rss+xml" title="Luis Quintanilla Blog RSS Feed" href="/blog.rss"><link rel="alternate" type="application/rss+xml" title="Luis Quintanilla Microblog RSS Feed" href="/microblog.rss"><link rel="alternate" type="application/rss+xml" title="Luis Quintanilla Response RSS Feed" href="/responses.rss"><link rel="webmention" title="Luis Quintanilla Webmention Endpoint" href="https://webmentions.lqdev.tech/api/inbox"><link rel="feeds" type="text/xml" title="Luis Quintanilla&#39;s Feeds" href="/feed/index.opml"><link rel="blogroll" type="text/xml" title="Luis Quintanilla&#39;s Blogroll" href="/collections/blogroll/index.opml"><link rel="podroll" type="text/xml" title="Luis Quintanilla&#39;s Podroll" href="/collections/podroll/index.opml"><link rel="youtuberoll" type="text/xml" title="Luis Quintanilla&#39;s YouTube Roll" href="/collections/youtube/index.opml"><meta name="robots" content="nosnippet"><title>Deploy ML.NET Machine Learning Model in Blazor WebAssembly Static Website - Luis Quintanilla</title></head><body><button class="mobile-toggle" id="mobile-nav-toggle" aria-label="Toggle navigation menu" aria-expanded="false"><div class="hamburger"><span></span><span></span><span></span></div></button><div class="nav-overlay" id="nav-overlay"></div><nav class="desert-nav" id="sidebar-menu" role="navigation" aria-label="Main navigation"><div class="nav-brand"><a href="/" class="brand-text"><img src="/avatar.png" alt="Luis Quintanilla avatar" loading="lazy">Luis Quintanilla</a></div><div class="nav-section"><a class="nav-link" href="/"><svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L8.354 1.146zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4H2.5z"></path></svg>Home</a><a class="nav-link" href="/about"><svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"></path></svg>About</a><a class="nav-link" href="/contact"><svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z"></path></svg>Contact</a><a class="nav-link" href="/search"><svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"></path></svg>Search</a><a class="nav-link" href="/feed"><svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M5.5 12a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm-3-8.5a1 1 0 0 1 1-1c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1-1-1zm0 4a1 1 0 0 1 1-1 6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1-1-1z"></path></svg>Subscribe</a></div><div class="nav-section dropdown"><button class="nav-link dropdown-toggle" data-target="collections-dropdown"><svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M2.5 3A1.5 1.5 0 0 0 1 4.5v.793c.026.009.051.02.076.032L7.674 8.51c.206.1.446.1.652 0l6.598-3.185A.755.755 0 0 1 15 5.293V4.5A1.5 1.5 0 0 0 13.5 3h-11Z"></path><path d="M15 6.954 8.978 9.86a2.25 2.25 0 0 1-1.956 0L1 6.954V11.5A1.5 1.5 0 0 0 2.5 13h11a1.5 1.5 0 0 0 1.5-1.5V6.954Z"></path></svg>Collections<svg class="dropdown-arrow" viewBox="0 0 16 16" fill="currentColor"><path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"></path></svg></button><div class="dropdown-menu" id="collections-dropdown"><a class="dropdown-item" href="/collections/blogroll">Blogroll</a><a class="dropdown-item" href="/collections/podroll">Podroll</a><a class="dropdown-item" href="/collections/youtube">YouTube</a><a class="dropdown-item" href="/collections/forums">Forums</a><div class="dropdown-divider"></div><a class="dropdown-item" href="/collections/starter-packs">Starter Packs</a><div class="dropdown-divider"></div><a class="dropdown-item" href="/radio">Radio</a><a class="dropdown-item" href="/tags">Tags</a></div></div><div class="nav-section dropdown"><button class="nav-link dropdown-toggle" data-target="resources-dropdown"><svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z"></path></svg>Resources<svg class="dropdown-arrow" viewBox="0 0 16 16" fill="currentColor"><path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"></path></svg></button><div class="dropdown-menu" id="resources-dropdown"><a class="dropdown-item" href="/resources/snippets">Snippets</a><a class="dropdown-item" href="/resources/wiki">Wiki</a><a class="dropdown-item" href="/resources/presentations">Presentations</a></div></div><div class="theme-toggle"><button class="theme-toggle-btn" id="theme-toggle" aria-label="Toggle dark mode"><span id="theme-toggle-icon">☀️</span><span>Theme</span></button></div></nav><main role="main" class="main-content" id="main-content"><div class="content-wrapper"><div class="mr-auto"><article class="h-entry individual-post"><header class="post-header"><h1 class="p-name post-title">Deploy ML.NET Machine Learning Model in Blazor WebAssembly Static Website</h1><div class="post-meta"><time class="dt-published" datetime="2020-03-01 19:21:04 -05:00">March 1, 2020</time></div><div class="u-author h-card microformat-hidden"><img src="/avatar.png" class="u-photo" alt="Luis Quintanilla" /><a href="/about" class="u-url p-name">Luis Quintanilla</a></div></header><div class="e-content post-content"><h2>Introduction</h2>
<p>There are many ways of deploying machine learning models. The most common way to do so is by exposing models as a web service through APIs or serverless functions. One of the considerations when deploying a model as a web service is latency and performance. The process of making predictions over HTTP using a model involves accepting the user input, loading the serialized version of the model from a file, using the model to make a prediction, and returning the prediction back to the user. Since models are typically just static files, another way of deploying a model is as a static asset over the web, just like any other HTML, CSS, or JavaScript file. This deployment method is similar to that of TensorFlow.js. Deploying in this way has several advantages. One advantage is that there is no longer a web service just to serve the model, making it more cost-efficient. Another advantage is that once the model has been downloaded onto the user's PC, the resources used at that point are those of the user's PC rather than the server the model would otherwise be hosted in. Finally, because the model is a static file, it can be distributed via CDNs.</p>
<p>One of the challenges with this is that machine learning models are usually built using languages other than JavaScript. This makes using the same code / library the model was built difficult or nearly impossible. WebAssembly is changing that by allowing Rust, C++, C# and other languages to run natively inside the browser. Having that ability, the code / logic to load the model and make predictions is much easier and almost comparable to that of a native platform. Blazor WebAssembly provides users the ability to create modern component-based web applications completely in C#. Additionally, Blazor WebAssembly allows users to publish and deploy their applications as static websites in an easy and cost-efficient way. ML.NET is an open-source, cross-platform framework that allows developers to create machine learning models using .NET. In this post, I'll show how to train a multiclass classification machine learning model that predicts iris flower species. Then, I'll take that model and deploy it alongside a Blazor WebAssembly static website to Azure Storage. The full code for this application may be found at the <a href="https://github.com/lqdev/MLNETBlazorWASMSample">MLNETBlazorWASMSample repository on GitHub</a>.</p>
<h2>Prerequisites</h2>
<p>This project was built on a Windows PC but should work cross platform on Mac and Linux.</p>
<ul>
<li><a href="https://dotnet.microsoft.com/download/dotnet-core/3.1">.NET Core SDK 3.1</a></li>
<li><a href="https://www.nuget.org/packages/Microsoft.AspNetCore.Blazor.Templates/3.2.0-preview1.20073.1">Blazor WebAssembly Template</a></li>
<li><a href="http://aka.ms/amlFree">Azure Subscription</a></li>
<li><a href="https://azure.microsoft.com/en-us/features/storage-explorer/">Azure Storage Explorer</a></li>
</ul>
<h2>Set up the solution</h2>
<p>The solution built in this post contains three projects:</p>
<ul>
<li>SchemaLibrary: C# .NET Standard 2.0 class library that contains the schema definition classes of the data used to train the model as well as the prediction output generated by the model.</li>
<li>TrainingConsole: C# .NET Core 3.1 console application used to train the machine learning model.</li>
<li>BlazorWebApp: Blazor WebAssembly web application to make predictions using machine learning model trained by TrainingConsole application.</li>
</ul>
<h3>Install Blazor WebAssembly Template</h3>
<p>Use the .NET CLI to run the following command in the command prompt:</p>
<pre><code class="language-powershell">dotnet new -i Microsoft.AspNetCore.Blazor.Templates::3.2.0-preview1.20073.1
</code></pre>
<h3>Create the solution</h3>
<p>Create a new directory for the solution called <em>MLNETBlazorWASMSample</em>.</p>
<pre><code class="language-powershell">mkdir MLNETBlazorWASMSample
</code></pre>
<p>Navigate to the newly created solution directory and create a solution:</p>
<pre><code class="language-powershell">cd MLNETBlazorWASMSample
dotnet new sln
</code></pre>
<h3>Create schema class library</h3>
<p>The data schema for the model input and output are shared during training as well as when making predictions. To share resources, create a class library that's shared by the <code>ConsoleTraining</code> and <code>BlazorWebApp</code> projects. In the solution directory, enter the following command:</p>
<pre><code class="language-powershell">dotnet new classlib -o SchemaLibrary
</code></pre>
<p>Install the <em>Microsoft.ML</em> NuGet package (This solution is built with version 1.4.0). The <em>Microsoft.ML</em> package is used throughout the entire solution.</p>
<pre><code class="language-powershell">dotnet add SchemaLibrary package Microsoft.ML
</code></pre>
<p>Add the library project to the solution.</p>
<pre><code class="language-powershell">dotnet sln add SchemaLibrary
</code></pre>
<h3>Create the training console application</h3>
<p>The console application contains the series of data transformations and algorithms used to train the model. In the solution directory, create a new console application.</p>
<pre><code class="language-powershell">dotnet new console -o TrainingConsole
</code></pre>
<p>Add the console application to the solution.</p>
<pre><code class="language-powershell">dotnet sln add TrainingConsole
</code></pre>
<p>Reference the <em>SchemaLibrary</em> project.</p>
<pre><code class="language-powershell">dotnet add TrainingConsole reference SchemaLibrary
</code></pre>
<h3>Create the Blazor WebAssembly web application</h3>
<p>The web application contains a few input elements so users can provide new data that the model then uses to make predictions. In the solution directory, create a new Blazor WebAssembly application.</p>
<pre><code class="language-powershell">dotnet new blazorwasm -o BlazorWebApp
</code></pre>
<p>Add the web application project to the solution.</p>
<pre><code class="language-powershell">dotnet sln add BlazorWebApp
</code></pre>
<p>Reference the <em>SchemaLibrary</em> project.</p>
<pre><code class="language-powershell">dotnet add BlazorWebApp reference SchemaLibrary
</code></pre>
<h2>Define the schema</h2>
<h3>Understand the data</h3>
<p>The data used to train the model comes from the <a href="https://archive.ics.uci.edu/ml/datasets/Iris">iris dataset</a>. It contains four numerical columns which are sepal and petal measurements and one numerical column for the species of iris flower. This is a sample of the data.</p>
<table class="table">
<thead>
<tr>
<th>Sepal length (cm)</th>
<th>Sepal width (cm)</th>
<th>Petal length (cm)</th>
<th>Petal width (cm)</th>
<th>Class (iris species)</th>
</tr>
</thead>
<tbody>
<tr>
<td>5.1</td>
<td>3.5</td>
<td>1.4</td>
<td>0.2</td>
<td>Iris-setosa</td>
</tr>
<tr>
<td>7.0</td>
<td>3.2</td>
<td>4.7</td>
<td>1.4</td>
<td>Iris-versicolor</td>
</tr>
<tr>
<td>6.3</td>
<td>3.3</td>
<td>6.0</td>
<td>2.5</td>
<td>Iris-virginica</td>
</tr>
</tbody>
</table>
<h3>Define model input schema</h3>
<p>In the <em>SchemaLibrary</em> project, create a class called <code>ModelInput</code> to model the data used for training and as model input.</p>
<pre><code class="language-powershell">ni ModelInput.cs
</code></pre>
<p>The <code>ModelInput</code> class should look like the following:</p>
<pre><code class="language-csharp">using Microsoft.ML.Data;

namespace SchemaLibrary
{
    public class ModelInput
    {
        [LoadColumn(0)]
        public float SepalLength { get; set; }

        [LoadColumn(1)]
        public float SepalWidth { get; set; }

        [LoadColumn(2)]
        public float PetalLength { get; set; }

        [LoadColumn(3)]
        public float PetalWidth { get; set; }

        [LoadColumn(4)]
        public string Label { get; set; }
    }
}
</code></pre>
<p>Notice that the <code>Class</code> column is now a property called <code>Label</code>. This is for two reasons:</p>
<ol>
<li>Avoid using the <code>class</code> keyword.</li>
<li>In ML.NET, the default column name of the column to predict expected by algorithms is <code>Label</code>.</li>
</ol>
<p>Also notice the <code>LoadColumn</code> attributes at the top of each property. This is used to tell the loader the index of the column where the data for the respective property is.</p>
<h3>Define model output schema</h3>
<p>Similar to the input schema, there's a schema for the output of the model. The type of model used in this solution is a multiclass classification model since there are more than two categories to choose from for iris flower species. Multiclass classification models output a column called <code>PredictedLabel</code> which contains the name of the predicted category. In the <em>SchemaLibrary</em> project, create a class called <code>ModelOutput</code> to model the predictions made by the model.</p>
<pre><code class="language-powershell">ni ModelOutput.cs
</code></pre>
<p>The <code>ModelOutput</code> class should look like the following:</p>
<pre><code class="language-csharp">namespace SchemaLibrary
{
    public class ModelOutput
    {
        public string PredictedLabel { get; set; }
    }
}
</code></pre>
<h2>Train the model</h2>
<p>Now it's time to create the application that trains the model.</p>
<h3>Get the data</h3>
<p>Download the data and save it inside the <em>TrainingConsole</em> project directory.</p>
<pre><code class="language-powershell">curl https://archive.ics.uci.edu/ml/machine-learning-databases/iris/iris.data -o iris.data
</code></pre>
<h3>Define the data preparation and training steps</h3>
<p>In the <em>TrainingConsole</em> project, open the <em>Program.cs</em> file and add the following using statements at the top:</p>
<pre><code class="language-csharp">using System;
using System.Linq;
using Microsoft.ML;
using SchemaLibrary;
</code></pre>
<p>Then, delete the contents inside the <code>Main</code> method and replace it with the following.</p>
<pre><code class="language-csharp">// 1. Initialize MLContext
MLContext mlContext = new MLContext();

// 2. Load the data
IDataView data = mlContext.Data.LoadFromTextFile&lt;ModelInput&gt;(&quot;iris.data&quot;, separatorChar:',');

// 3. Shuffle the data
IDataView shuffledData = mlContext.Data.ShuffleRows(data);

// 3. Define the data preparation and training pipeline.
IEstimator&lt;ITransformer&gt; pipeline = 
    mlContext.Transforms.Concatenate(&quot;Features&quot;,&quot;SepalLength&quot;,&quot;SepalWidth&quot;,&quot;PetalLength&quot;,&quot;PetalWidth&quot;)
        .Append(mlContext.Transforms.NormalizeMinMax(&quot;Features&quot;))
        .Append(mlContext.Transforms.Conversion.MapValueToKey(&quot;Label&quot;))
        .Append(mlContext.MulticlassClassification.Trainers.NaiveBayes())
        .Append(mlContext.Transforms.Conversion.MapKeyToValue(&quot;PredictedLabel&quot;));

// 4. Train with cross-validation
var cvResults = mlContext.MulticlassClassification.CrossValidate(shuffledData, pipeline);

// 5. Get the highest performing model and its accuracy
(ITransformer, double) model = 
    cvResults
        .OrderByDescending(fold =&gt; fold.Metrics.MacroAccuracy)
        .Select(fold =&gt; (fold.Model, fold.Metrics.MacroAccuracy))
        .First();

Console.WriteLine($&quot;Top performing model's macro-accuracy: {model.Item2}&quot;);

// 6. Save the model
mlContext.Model.Save(model.Item1, data.Schema, &quot;model.zip&quot;);

Console.WriteLine(&quot;Model trained&quot;);
</code></pre>
<p>The training application loads the data from the <code>iris.data</code> file and applies a series of transformations. First, all of the individual numerical columns are combined into a single vector and stored in a new column called <code>Features</code>. The <code>Features</code> column is then normalized and the <code>MapValueToKey</code> transform is used to convert the text in the <code>Label</code> column to a number. Then, the transformed data is used to train a model using the <code>NaiveBayes</code> algorithm. <strong>Note that at the time of this writing, for multiclass classification problems, only Naive Bayes has been confirmed to work with Blazor WebAssembly</strong>. Finally, the <code>PredictedLabel</code> is stored as a number so it has to be converted back into text.</p>
<p>Using the <code>Fit</code> method, the data is applied to the pipeline. Because the dataset is small, a technique called cross-validation is used to build a more robust model. Once the model is trained, the model with the top performance is then serialized and saved to a file called <em>model.zip</em> for later use in the web application.</p>
<p>The final <em>Program.cs</em> file should look like the content below:</p>
<pre><code class="language-csharp">using System;
using System.Linq;
using Microsoft.ML;
using SchemaLibrary;

namespace TrainingConsole
{
    class Program
    {
        static void Main(string[] args)
        {
            // 1. Initialize MLContext
            MLContext mlContext = new MLContext();

            // 2. Load the data
            IDataView data = mlContext.Data.LoadFromTextFile&lt;ModelInput&gt;(&quot;iris.data&quot;, separatorChar:',');

            // 3. Shuffle the data
            IDataView shuffledData = mlContext.Data.ShuffleRows(data);

            // 3. Define the data preparation and training pipeline.
            IEstimator&lt;ITransformer&gt; pipeline = 
                mlContext.Transforms.Concatenate(&quot;Features&quot;,&quot;SepalLength&quot;,&quot;SepalWidth&quot;,&quot;PetalLength&quot;,&quot;PetalWidth&quot;)
                    .Append(mlContext.Transforms.NormalizeMinMax(&quot;Features&quot;))
                    .Append(mlContext.Transforms.Conversion.MapValueToKey(&quot;Label&quot;))
                    .Append(mlContext.MulticlassClassification.Trainers.NaiveBayes())
                    .Append(mlContext.Transforms.Conversion.MapKeyToValue(&quot;PredictedLabel&quot;));

            // 4. Train with cross-validation
            var cvResults = mlContext.MulticlassClassification.CrossValidate(shuffledData, pipeline);

            // 5. Get the highest performing model and its accuracy
            (ITransformer, double) model = 
                cvResults
                    .OrderByDescending(fold =&gt; fold.Metrics.MacroAccuracy)
                    .Select(fold =&gt; (fold.Model, fold.Metrics.MacroAccuracy))
                    .First();

            Console.WriteLine($&quot;Top performing model's macro-accuracy: {model.Item2}&quot;);

            // 6. Save the model
            mlContext.Model.Save(model.Item1, data.Schema, &quot;model.zip&quot;);

            Console.WriteLine(&quot;Model trained&quot;);
        }
    }
}
</code></pre>
<h3>Run the application</h3>
<p>In the <em>TrainConsole</em> project directory, use the following command to run the application and train the model:</p>
<pre><code class="language-powershell">dotnet run
</code></pre>
<h2>Host the model</h2>
<p>Once you have the model saved, use the Azure Portal to create an Azure Storage account.</p>
<p><img src="http://cdn.lqdev.tech/files/images/deploy-machine-learning-mlnet-model-blazor-webassembly1.png" class="img-fluid" alt="Create Azure Storage Account" /></p>
<p>Then, navigate to your newly created storage account resource and create a blob container called <code>models</code>.</p>
<p><img src="http://cdn.lqdev.tech/files/images/deploy-machine-learning-mlnet-model-blazor-webassembly2.png" class="img-fluid" alt="Create Blob Container" /></p>
<p>Once your container is created, navigate to it and upload the <em>model.zip</em> file.</p>
<p><img src="http://cdn.lqdev.tech/files/images/deploy-machine-learning-mlnet-model-blazor-webassembly3.png" class="img-fluid" alt="Upload Model" /></p>
<h2>Create prediction web page</h2>
<p>To make predictions, create a web page to take in user input. Then, provide the user input to the model and display the prediction to the user.</p>
<h3>Set up imports</h3>
<p>In the <em>BlazorWebApp</em> project directory, open the <em>_Imports.razor</em> file. This contains the using statements for the pages and components in your application. Add the following using statements:</p>
<pre><code class="language-razor">@using System.IO
@using Microsoft.ML
@using SchemaLibrary
</code></pre>
<h3>Create user input page</h3>
<p>In the <em>BlazorWebApp</em> project, create a new razor page called <em>Prediction.razor</em> inside the <em>Pages</em> directory.</p>
<pre><code class="language-powershell">ni Prediction.razor
</code></pre>
<p>Add the following content to it:</p>
<pre><code class="language-razor">@page &quot;/prediction&quot;
@inject HttpClient _client

&lt;label&gt;Sepal Length: &lt;/label&gt;
&lt;input type=&quot;text&quot; @bind=&quot;_sepalLength&quot;&gt;&lt;br&gt;
&lt;label&gt;Sepal Width: &lt;/label&gt;
&lt;input type=&quot;text&quot; @bind=&quot;_sepalWidth&quot;&gt;&lt;br&gt;
&lt;label&gt;Petal Length: &lt;/label&gt;
&lt;input type=&quot;text&quot; @bind=&quot;_petalLength&quot;&gt;&lt;br&gt;
&lt;label&gt;Petal Width: &lt;/label&gt;
&lt;input type=&quot;text&quot; @bind=&quot;_petalWidth&quot;&gt;&lt;br&gt;
&lt;button @onclick=&quot;GetPrediction&quot;&gt;Make prediction&lt;/button&gt;
@if(@ModelPrediction == null)
{
    &lt;p&gt;Enter data to get a prediction&lt;/p&gt;
} else
{
    &lt;p&gt;@ModelPrediction&lt;/p&gt;
}


@code {
    private PredictionEngine&lt;ModelInput,ModelOutput&gt; _predictionEngine;
    private string _sepalLength, _sepalWidth, _petalLength, _petalWidth, ModelPrediction;

    protected override async Task OnInitializedAsync()
    {
        Stream savedModel = await _client.GetStreamAsync(&quot;&lt;YOUR-MODEL-ENDPOINT&gt;&quot;);
        MLContext mlContext = new MLContext();
        ITransformer _model = mlContext.Model.Load(savedModel,out DataViewSchema schema);
        _predictionEngine = mlContext.Model.CreatePredictionEngine&lt;ModelInput,ModelOutput&gt;(_model);
    }

    private void GetPrediction()
    {
        ModelInput input = new ModelInput
        {
            SepalLength=float.Parse(_sepalLength),
            SepalWidth=float.Parse(_sepalWidth),
            PetalLength=float.Parse(_petalLength),
            PetalWidth=float.Parse(_petalWidth)
        };

        ModelOutput prediction = _predictionEngine.Predict(input);

        ModelPrediction = prediction.PredictedLabel;
    }
}
</code></pre>
<p>The <em>Predict.razor</em> page contains a text input element for each of the columns the model was original trained on. When the page is initialized, the model is loaded from Azure Storage and a <code>PredictionEngine</code> is created. <strong>Make sure to replace <code>&lt;YOUR-MODEL-ENDPOINT&gt;</code> with the URL of the blob that contains your <code>model.zip</code></strong>. A <code>PredictionEngine</code> is a convenience API to make a single prediction. Traditionally when models are served as a web service, it is recommended to use the <code>PredictionEnginePool</code> service because it's thread-safe and more performant in multi-threaded application. However, in this case since the model is downloaded onto the individual user's browser, it's okay to use <code>PredictionEngine</code>. After a user enters input values and clicks the &quot;Make Prediction&quot; button, the <code>GetPrediction</code> method executes by taking the user input and making a prediction using the <code>PredictionEngine</code>. The prediction is then displayed in the browser.</p>
<h3>Add to navigation menu</h3>
<p>In the <em>BlazorWebApp</em> project, open the <em>NavMenu.razor</em> file in the <em>Shared</em> directory.</p>
<p>Add the following list item to the <code>&lt;ul&gt;</code> element.</p>
<pre><code class="language-html">&lt;li class=&quot;nav-item px-3&quot;&gt;
    &lt;NavLink class=&quot;nav-link&quot; href=&quot;prediction&quot;&gt;
        &lt;span class=&quot;oi oi-list-rich&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; Prediction
    &lt;/NavLink&gt;
&lt;/li&gt;
</code></pre>
<p>The final <em>NavMenu.razor</em> page should look like the following:</p>
<pre><code class="language-razor">&lt;div class=&quot;top-row pl-4 navbar navbar-dark&quot;&gt;
    &lt;a class=&quot;navbar-brand&quot; href=&quot;&quot;&gt;BlazorWebApp&lt;/a&gt;
    &lt;button class=&quot;navbar-toggler&quot; @onclick=&quot;ToggleNavMenu&quot;&gt;
        &lt;span class=&quot;navbar-toggler-icon&quot;&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/div&gt;

&lt;div class=&quot;@NavMenuCssClass&quot; @onclick=&quot;ToggleNavMenu&quot;&gt;
    &lt;ul class=&quot;nav flex-column&quot;&gt;
        &lt;li class=&quot;nav-item px-3&quot;&gt;
            &lt;NavLink class=&quot;nav-link&quot; href=&quot;&quot; Match=&quot;NavLinkMatch.All&quot;&gt;
                &lt;span class=&quot;oi oi-home&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; Home
            &lt;/NavLink&gt;
        &lt;/li&gt;
        &lt;li class=&quot;nav-item px-3&quot;&gt;
            &lt;NavLink class=&quot;nav-link&quot; href=&quot;counter&quot;&gt;
                &lt;span class=&quot;oi oi-plus&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; Counter
            &lt;/NavLink&gt;
        &lt;/li&gt;
        &lt;li class=&quot;nav-item px-3&quot;&gt;
            &lt;NavLink class=&quot;nav-link&quot; href=&quot;fetchdata&quot;&gt;
                &lt;span class=&quot;oi oi-list-rich&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; Fetch data
            &lt;/NavLink&gt;
        &lt;/li&gt;
        &lt;li class=&quot;nav-item px-3&quot;&gt;
            &lt;NavLink class=&quot;nav-link&quot; href=&quot;prediction&quot;&gt;
                &lt;span class=&quot;oi oi-list-rich&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; Prediction
            &lt;/NavLink&gt;
        &lt;/li&gt;
    &lt;/ul&gt;
&lt;/div&gt;

@code {
    private bool collapseNavMenu = true;

    private string NavMenuCssClass =&gt; collapseNavMenu ? &quot;collapse&quot; : null;

    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }
}
</code></pre>
<h2>Configure the web application</h2>
<p>The web application will he hosted as a static site on Azure Storage.</p>
<p>In the Azure Portal, navigate to the storage account resource where you are hosting your model.</p>
<h3>Enable static website</h3>
<p>Enable a static website for the storage account and set the index document name and error document path to <em>index.html</em>.</p>
<p><img src="http://cdn.lqdev.tech/files/images/deploy-machine-learning-mlnet-model-blazor-webassembly4.png" class="img-fluid" alt="Enable Static Website" /></p>
<p>At this point, a new container called <em>$web</em> is created in your storage account. This is where all your site's static files will reside. Additionally, a primary endpoint is created. This is the URL you will use to access your application</p>
<h3>Configure CORS</h3>
<p>The storage account has some default CORS settings. In order to download and use your model from your application, you'll have to configure them.</p>
<p><img src="http://cdn.lqdev.tech/files/images/deploy-machine-learning-mlnet-model-blazor-webassembly5.png" class="img-fluid" alt="Configure CORS" /></p>
<p>For &quot;Allowed origins&quot;, enter your primary endpoint.</p>
<h2>Publish and deploy the web application</h2>
<p>To publish your application, run the following command:</p>
<pre><code class="language-powershell">dotnet publish -c Release
</code></pre>
<p>This generates all the files you'll need to host your web application as a static site in the <em>bin/Release/netstandard2.1/publish/BlazorWebApp/dist</em> directory of your <em>BlazorWebApp</em> project.</p>
<p>To deploy your application, use Azure Storage Explorer to copy all of the files in the <em>dist</em> directory into the <em>$web</em> container of your Azure Storage Account.</p>
<p><img src="http://cdn.lqdev.tech/files/images/deploy-machine-learning-mlnet-model-blazor-webassembly6.png" class="img-fluid" alt="Copy files into web container" /></p>
<h2>Test the application</h2>
<p>In your browser, navigate to your static website's primary endpoint and select the Prediction page. Input data and click &quot;Make prediction&quot;. The page should look as follows.</p>
<p><img src="http://cdn.lqdev.tech/files/images/deploy-machine-learning-mlnet-model-blazor-webassembly7.png" class="img-fluid" alt="Test the application" /></p>
<p><strong>You may note that performance of Naive Bayes on this dataset is not the best so some of the predictions may not be as accurate. I am okay with this at the moment because this is a proof-of-concept to show how these technologies might work together. Perhaps using a better dataset may yield better results.</strong></p>
<h2>Conclusion</h2>
<p>In this post, I went over how to deploy an ML.NET multiclass classification model alongside a Blazor WebAssembly static website to Azure Storage. While more limited than other methods of deployment due to the early stages of WebAssembly and Blazor WebAssembly, this shows the possibilities for the technologies. Deploying in this manner reduces the amount of resources required to deploy these models and shifts processing from a server or web service to the client's browser making deployment and distribution of machine learning models more efficient, scalable and cost-efficient.</p>
</div><footer class="post-footer"><div class="permalink-info">Permalink: <a class="u-url permalink-link" href="/posts/deploy-machine-learning-mlnet-models-blazor-webassembly/">/posts/deploy-machine-learning-mlnet-models-blazor-webassembly/</a></div><div><script type="application/javascript">window.onload = function() { document.getElementById('webmention-target').value = window.location.href }</script><form action="https://webmentions.lqdev.tech/api/inbox" method="POST" enctype="application/x-www-form-urlencoded"><h5 class="text-center">Send me a <a href="/contact">message</a> or <a href="https://indieweb.org/webmentions">webmention</a></h5><div class="form-row justify-content-center"><div class="w-75"><input type="url" class="form-control" name="source" placeholder="Your URL (webmention source)" required /></div><div class="col-auto"><input type="submit" class="btn btn-primary" value="Send" /></div><input type="hidden" readonly name="target" id="webmention-target" /></div></form></div></footer></article></div></div></main><script src="/assets/lib/jquery/jquery.slim.min.js"></script><script src="/assets/lib/boostrap/bootstrap.min.js"></script><script src="/assets/lib/highlight/highlight.min.js"></script><script src="/assets/lib/highlight/highlight.fsharp.min.js"></script><script src="/assets/lib/highlight/highlight.nix.min.js"></script><script src="/assets/js/timeline.js"></script><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script type="application/javascript">mermaid.initialize({startOnLoad:true});</script><script type="application/javascript">hljs.initHighlightingOnLoad();</script><script src="/lib/revealjs/dist/reveal.js"></script><script src="/lib/revealjs/plugin/markdown/markdown.js"></script><script src="/lib/revealjs/plugin/highlight/highlight.js"></script><script type="application/javascript">
                    // Initialize Reveal.js when a presentation container is found on the page
                    document.addEventListener('DOMContentLoaded', function() {
                        const presentationContainer = document.querySelector('.presentation-container');
                        if (presentationContainer && typeof Reveal !== 'undefined') {
                            Reveal.initialize({
                                plugins: [RevealMarkdown, RevealHighlight],
                                embedded: true
                            });
                        }
                    });
                    </script></body><footer><a rel="me" href="https://toot.lqdev.tech/@lqdev"></a><a rel="me" href="https://github.com/lqdev"></a><a rel="me" href="https://twitter.com/ljquintanilla"></a><a rel="me" href="https://www.linkedin.com/in/lquintanilla01/"></a><a rel="me" href="mailto:lqdev@outlook.com"></a></footer></html>