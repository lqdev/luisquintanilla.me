<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link rel="stylesheet" href="/assets/css/custom/main.css"><link rel="stylesheet" href="/assets/css/custom/timeline.css"><link rel="stylesheet" href="/assets/css/bootstrap-icons-1.5.0/bootstrap-icons.css"><link rel="stylesheet" href="/assets/css/highlight.github-dark-dimmed.min.css"><link rel="stylesheet" href="/assets/css/main.css"><link rel="stylesheet" href="/lib/revealjs/dist/reveal.css"><link rel="stylesheet" href="/lib/revealjs/dist/theme/black.css"><link rel="stylesheet" href="/lib/revealjs/plugin/highlight/monokai.css"><meta property="og:title" content="Use machine learning to categorize web links with F# and ML.NET - Luis Quintanilla"><meta property="og:type" content="website"><meta property="og:image" content="https://www.lqdev.me/avatar.png"><meta property="og:image:secure_url" content="https://www.lqdev.me/avatar.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="200"><meta property="og:image:height" content="200"><meta property="og:site_name" content="Luis Quintanilla Personal Website"><meta property="og:locale" content="en_US"><meta property="twitter:image" content="https://www.lqdev.me/avatar.png"><meta property="fediverse:creator" content="@lqdev@toot.lqdev.tech"><link rel="alternate" type="application/rss+xml" title="Luis Quintanilla Blog RSS Feed" href="/blog.rss"><link rel="alternate" type="application/rss+xml" title="Luis Quintanilla Microblog RSS Feed" href="/microblog.rss"><link rel="alternate" type="application/rss+xml" title="Luis Quintanilla Response RSS Feed" href="/responses.rss"><link rel="webmention" title="Luis Quintanilla Webmention Endpoint" href="https://webmentions.lqdev.tech/api/inbox"><link rel="feeds" type="text/xml" title="Luis Quintanilla&#39;s Feeds" href="/feed/index.opml"><link rel="blogroll" type="text/xml" title="Luis Quintanilla&#39;s Blogroll" href="/collections/blogroll/index.opml"><link rel="podroll" type="text/xml" title="Luis Quintanilla&#39;s Podroll" href="/collections/podroll/index.opml"><link rel="youtuberoll" type="text/xml" title="Luis Quintanilla&#39;s YouTube Roll" href="/collections/youtube/index.opml"><meta name="robots" content="nosnippet"><title>Use machine learning to categorize web links with F# and ML.NET - Luis Quintanilla</title></head><body><button class="mobile-toggle" id="mobile-nav-toggle" aria-label="Toggle navigation menu" aria-expanded="false"><div class="hamburger"><span></span><span></span><span></span></div></button><div class="nav-overlay" id="nav-overlay"></div><nav class="desert-nav" id="sidebar-menu" role="navigation" aria-label="Main navigation"><div class="nav-brand"><a href="/" class="brand-text"><img src="/avatar.png" alt="Luis Quintanilla avatar" loading="lazy">Luis Quintanilla</a></div><div class="nav-section"><a class="nav-link" href="/"><svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L8.354 1.146zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4H2.5z"></path></svg>Home</a><a class="nav-link" href="/about"><svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"></path></svg>About</a><a class="nav-link" href="/contact"><svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z"></path></svg>Contact</a><a class="nav-link" href="/search"><svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"></path></svg>Search</a><a class="nav-link" href="/feed"><svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M5.5 12a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm-3-8.5a1 1 0 0 1 1-1c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1-1-1zm0 4a1 1 0 0 1 1-1 6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1-1-1z"></path></svg>Subscribe</a></div><div class="nav-section dropdown"><button class="nav-link dropdown-toggle" data-target="collections-dropdown"><svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M2.5 3A1.5 1.5 0 0 0 1 4.5v.793c.026.009.051.02.076.032L7.674 8.51c.206.1.446.1.652 0l6.598-3.185A.755.755 0 0 1 15 5.293V4.5A1.5 1.5 0 0 0 13.5 3h-11Z"></path><path d="M15 6.954 8.978 9.86a2.25 2.25 0 0 1-1.956 0L1 6.954V11.5A1.5 1.5 0 0 0 2.5 13h11a1.5 1.5 0 0 0 1.5-1.5V6.954Z"></path></svg>Collections<svg class="dropdown-arrow" viewBox="0 0 16 16" fill="currentColor"><path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"></path></svg></button><div class="dropdown-menu" id="collections-dropdown"><a class="dropdown-item" href="/collections/blogroll">Blogroll</a><a class="dropdown-item" href="/collections/podroll">Podroll</a><a class="dropdown-item" href="/collections/youtube">YouTube</a><a class="dropdown-item" href="/collections/forums">Forums</a><div class="dropdown-divider"></div><a class="dropdown-item" href="/collections/starter-packs">Starter Packs</a><div class="dropdown-divider"></div><a class="dropdown-item" href="/radio">Radio</a><a class="dropdown-item" href="/tags">Tags</a></div></div><div class="nav-section dropdown"><button class="nav-link dropdown-toggle" data-target="resources-dropdown"><svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z"></path></svg>Resources<svg class="dropdown-arrow" viewBox="0 0 16 16" fill="currentColor"><path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"></path></svg></button><div class="dropdown-menu" id="resources-dropdown"><a class="dropdown-item" href="/resources/snippets">Snippets</a><a class="dropdown-item" href="/resources/wiki">Wiki</a><a class="dropdown-item" href="/resources/presentations">Presentations</a></div></div><div class="theme-toggle"><button class="theme-toggle-btn" id="theme-toggle" aria-label="Toggle dark mode"><span id="theme-toggle-icon">☀️</span><span>Theme</span></button></div></nav><main role="main" class="main-content" id="main-content"><div class="content-wrapper"><div class="mr-auto"><article class="h-entry individual-post"><header class="post-header"><h1 class="p-name post-title">Use machine learning to categorize web links with F# and ML.NET</h1><div class="post-meta"><time class="dt-published" datetime="2019-12-17 19:59:06 -05:00">December 17, 2019</time></div><div class="u-author h-card microformat-hidden"><img src="/avatar.png" class="u-photo" alt="Luis Quintanilla" /><a href="/about" class="u-url p-name">Luis Quintanilla</a></div></header><div class="e-content post-content"><h2>Introduction</h2>
<p>This post is part of <a href="https://sergeytihon.com/2019/11/05/f-advent-calendar-in-english-2019/">F# Advent 2019</a>. Thank you <a href="https://twitter.com/sergey_tihon">Sergey Tihon</a> for organizing this and the rest of the contributors for producing interesting, high-quality content.</p>
<p>I scan and read articles on a constant basis, such as those published as part of F# Advent. Those that I find interesting, or I want to save for later, I bookmark using <a href="https://getpocket.com/">Pocket</a>. One of the neat features it provides is tagging. You can add as many tags as you want to organize the bookmarked links. When I first started using the service, I was fairly good at adding tags. However, I've gotten lazy and don't do it as much. It would be nice if bookmarked links could automatically be categorized for me without having to provide the tags manually. Using machine learning, this task can be automated. In this writeup, I will show how to build a machine learning model using <a href="https://dotnet.microsoft.com/apps/machinelearning-ai/ml-dotnet">ML.NET</a>, a .NET, open-source, cross-platform machine learning framework to automatically categorize web links / articles.</p>
<h2>Prerequisites</h2>
<p>This application was built on a Windows 10 PC, but should work cross-platform.</p>
<ul>
<li><a href="https://dotnet.microsoft.com/download">.NET Core SDK 2.1+</a></li>
<li><a href="https://code.visualstudio.com/Download">Visual Studio Code</a></li>
<li><a href="http://ionide.io/">Ionide</a></li>
<li><a href="https://www.nuget.org/packages/Microsoft.ML/">Microsoft.ML NuGet package</a></li>
</ul>
<h2>Create the solution</h2>
<p>Make a new directory and create a solution by using the .NET CLI.</p>
<pre><code class="language-powershell">mkdir FsAdvent2019
cd FsAdvent2019
dotnet new sln
</code></pre>
<p>Then, create an F# Console application.</p>
<pre><code class="language-powershell">dotnet new console -o FsAdvent2019 -lang f#
</code></pre>
<p>Navigate to the console application directory and install the Microsoft.ML NuGet package.</p>
<pre><code class="language-powershell">cd FsAdvent2019
dotnet add package Microsoft.ML -v 1.4.0
</code></pre>
<h2>Get the data</h2>
<p><a href="https://archive.ics.uci.edu/ml/machine-learning-databases/00359/NewsAggregatorDataset.zip">Click on this link to download and unzip the data anywhere on your PC</a>.</p>
<p>The data contains information about several articles that are separated into four categories: business (b), science and technology (t), entertainment (e) and health (h). Visit the <a href="https://archive.ics.uci.edu/ml/datasets/News+Aggregator">UCI Machine Learning repository website</a> to learn more about the dataset.</p>
<p>Below is a sample of the data.</p>
<pre><code class="language-text">ID    Title    Url    Publisher    Category    Story    Hostname    Timestamp
2	Fed's Charles Plosser sees high bar for change in pace of tapering	http://www.livemint.com/Politics/H2EvwJSK2VE6OF7iK1g3PP/Feds-Charles-Plosser-sees-high-bar-for-change-in-pace-of-ta.html	Livemint	b	ddUyU0VZz0BRneMioxUPQVP6sIxvM	www.livemint.com	1394470371207
3	US open: Stocks fall after Fed official hints at accelerated tapering	http://www.ifamagazine.com/news/us-open-stocks-fall-after-fed-official-hints-at-accelerated-tapering-294436	IFA Magazine	b	ddUyU0VZz0BRneMioxUPQVP6sIxvM	www.ifamagazine.com	1394470371550
4	Fed risks falling 'behind the curve', Charles Plosser says	http://www.ifamagazine.com/news/fed-risks-falling-behind-the-curve-charles-plosser-says-294430	IFA Magazine	b	ddUyU0VZz0BRneMioxUPQVP6sIxvM	www.ifamagazine.com	1394470371793
</code></pre>
<p>Inside the console application directory, create a new directory called <em>data</em> and copy the <em>newsCorpora.csv</em> file to it.</p>
<pre><code class="language-powershell">mkdir data
</code></pre>
<h2>Define the schema</h2>
<p>Open the <em>Program.fs</em> file and add the following <code>open</code> statements at the top.</p>
<pre><code class="language-fsharp">open Microsoft.ML
open Microsoft.ML.Data
</code></pre>
<p>Directly below the <code>open</code> statements, define the data schema of the input and output of the machine learning model as records called <code>ModelInput</code> and <code>ModelOutput</code> respectively.</p>
<pre><code class="language-fsharp">[&lt;CLIMutable&gt;]
type ModelInput = {
    [&lt;LoadColumn(1)&gt;]
    Title:string
    [&lt;LoadColumn(2)&gt;]
    Url:string
    [&lt;LoadColumn(3)&gt;]
    Publisher:string
    [&lt;LoadColumn(4)&gt;]
    Category:string
    [&lt;LoadColumn(6)&gt;]
    Hostname:string
}

[&lt;CLIMutable&gt;]
type ModelOutput = {
    PredictedLabel: string
}
</code></pre>
<p>As input, only the <strong>Title</strong>, <strong>Url</strong>, <strong>Publisher</strong> and <strong>Hostname</strong> columns are used to train the machine learning model and make predictions. The label or value to predict in this case is the <strong>Category</strong>. When a prediction is output by the model, its value is stored in a column called <strong>PredictedLabel</strong>.</p>
<h2>Create the application entry point</h2>
<p>The <code>MLContext</code> is the entry point of all ML.NET applications which binds all tasks like data loading, data transformations, model training, model evaluation, and model saving/loading.</p>
<p>Inside of the <code>main</code> function, create an instance of <code>MLContext</code>.</p>
<pre><code class="language-fsharp">let mlContext = MLContext()
</code></pre>
<h2>Load the data</h2>
<p>Once the <code>MLContext</code> is initialized, use the <code>LoadFromTextFile</code> function and provide the path to the file containing the data.</p>
<pre><code class="language-fsharp">let data = mlContext.Data.LoadFromTextFile&lt;ModelInput&gt;(&quot;data/newsCorpora.csv&quot;)
</code></pre>
<h2>Create training and test datasets</h2>
<p>It's often good practice to split the data into train and test sets. The goal of a machine learning model is to accurately make predictions on data it has not seen before. Therefore, making predictions using inputs that are the same as those it was trained on may provide misleading accuracy metrics.</p>
<p>Use the <code>TrainTestSplit</code> to split the data into train / test sets with 90% of the data used for training and 10% used for testing.</p>
<pre><code class="language-fsharp">let datasets = mlContext.Data.TrainTestSplit(data,testFraction=0.1)
</code></pre>
<h2>Define the transformation and algorithm pipelines</h2>
<p>Now that the data is split, define the set of transformations to be applied to the data. The purpose of transforming the data is to convert it into numbers which are more easily processed by machine learning algorithms.</p>
<h3>Preprocessing pipeline</h3>
<p>The preprocessing pipeline contains the series of transformations that take place before training the model. To create a pipeline, initialize an <code>EstimatorChain</code> and append the desired transformations to it.</p>
<pre><code class="language-fsharp">let preProcessingPipeline = 
    EstimatorChain()
        .Append(mlContext.Transforms.Text.FeaturizeText(&quot;FeaturizedTitle&quot;,&quot;Title&quot;))
        .Append(mlContext.Transforms.Text.FeaturizeText(&quot;FeaturizedUrl&quot;,&quot;Url&quot;))
        .Append(mlContext.Transforms.Text.FeaturizeText(&quot;FeaturizedPublisher&quot;,&quot;Publisher&quot;))
        .Append(mlContext.Transforms.Text.FeaturizeText(&quot;FeaturizedHost&quot;,&quot;Hostname&quot;))
        .Append(mlContext.Transforms.Concatenate(&quot;Features&quot;,[|&quot;FeaturizedTitle&quot;; &quot;FeaturizedUrl&quot; ;&quot;FeaturizedPublisher&quot;; &quot;FeaturizedHost&quot;|]))
        .Append(mlContext.Transforms.Conversion.MapValueToKey(&quot;Label&quot;,&quot;Category&quot;))
</code></pre>
<p>In this preprocessing pipeline, the following transformations are taking place:</p>
<ol>
<li>Convert the <em>Title</em>, <em>Url</em>, <em>Publisher</em> and <em>Hostname</em> columns into numbers and store the transformed value into the <em>FeaturizedTitle</em>, <em>FeaturizedUrl</em>, <em>FeaturizedPublisher</em> and <em>FeaturizedHost</em> columns respectively.</li>
<li>Combine the <em>FeaturizedTitle</em>, <em>FeaturizedUrl</em>, <em>FeaturizedPublisher</em> and <em>FeaturizedHost</em> into one column called <em>Features</em>.</li>
<li>Create a mapping of the text value contained in the <em>Category</em> column to a numerical key and store the result into a new column called <em>Label</em>.</li>
</ol>
<h3>Algorithm pipeline</h3>
<p>The algorithm pipeline contains the algorithm used to train the machine learning model. In this application, the multiclass classification algorithm used is <code>LbfgsMaximumEntropy</code>. To learn more about the algorithm, see the <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.ml.trainers.lbfgsmaximumentropymulticlasstrainer?view=ml-dotnet#training-algorithm-details">ML.NET LbfgsMaximumEntropy multiclass trainer API documentation</a>.</p>
<pre><code class="language-fsharp">let algorithm = 
    mlContext.MulticlassClassification.Trainers.LbfgsMaximumEntropy()
</code></pre>
<h3>Postprocessing pipeline</h3>
<p>The postprocessing pipeline contains the series of transformations to get the output of training into a more readable format. The only transformation performed in this pipeline is mapping back the numerical value mapping of the predicted value into text form.</p>
<pre><code class="language-fsharp">let postProcessingPipeline = 
    mlContext.Transforms.Conversion.MapKeyToValue(&quot;PredictedLabel&quot;)
</code></pre>
<h3>Create training pipeline</h3>
<p>Once the pipelines are defined, combine them into a single pipeline which applies all of the transformations to the data with a single function call.</p>
<pre><code class="language-fsharp">let trainingPipeline = 
    preProcessingPipeline
        .Append(algorithm)
        .Append(postProcessingPipeline)
</code></pre>
<h2>Train the model</h2>
<p>Use the <code>Fit</code> function to train the model by applying the set of transformations defined by <code>trainingPipeline</code> to the training dataset.</p>
<pre><code class="language-fsharp">let model =
    datasets.TrainSet |&gt; trainingPipeline.Fit
</code></pre>
<h2>Evaluate the model</h2>
<p>Once the model is trained, evaluate how well it performs against the test dataset. First, use the trained model to get the predicted category by using the <code>Transform</code> function. Then, provide the test dataset containing predictions to the <code>Evaluate</code> function which calculates the model's performance metrics by comparing the predicted category to the actual category and print some of them out.</p>
<pre><code class="language-fsharp">let metrics = 
    (datasets.TestSet |&gt; model.Transform)
    |&gt; mlContext.MulticlassClassification.Evaluate

printfn &quot;Log Loss: %f | MacroAccuracy: %f&quot; metrics.LogLoss metrics.MacroAccuracy
</code></pre>
<h2>Using the model on real data</h2>
<p>Create a list of <code>ModelInput</code> items and use the <code>Transform</code> method to get the predicted category.</p>
<pre><code class="language-fsharp">let predictions = 
    [
        { 
            Title=&quot;A FIRST LOOK AT SURFACE DUO, MICROSOFT’S FOLDABLE ANDROID PHONE&quot;
            Url=&quot;https://www.theverge.com/2019/10/3/20895268/microsoft-surface-duo-foldable-phone-dual-screen-android-hands-on-features-price-photos-video&quot;
            Publisher=&quot;The Verge&quot;
            Hostname=&quot;www.theverge.com&quot; 
            Category = &quot;&quot; 
        }
        { 
            Title=&quot;This Shrinking Economy With Low Inflation Is Stuck on Rates&quot;
            Url=&quot;https://www.bloomberg.com/news/articles/2019-12-12/when-a-shrinking-economy-and-low-inflation-don-t-mean-rate-cuts?srnd=economics-vp&quot;
            Publisher=&quot;Bloomberg&quot;
            Hostname=&quot;www.bloomberg.com&quot; 
            Category = &quot;&quot; 
        }
    ] 
    |&gt; mlContext.Data.LoadFromEnumerable
    |&gt; model.Transform
</code></pre>
<p>Then, create a <code>Sequence</code> of <code>ModelOutput</code> values and print out the <em>PredictedLabel</em> values.</p>
<pre><code class="language-fsharp">mlContext.Data.CreateEnumerable&lt;ModelOutput&gt;(predictions,false)
|&gt; Seq.iter(fun prediction -&gt; printfn &quot;Predicted Value: %s&quot; prediction.PredictedLabel)
</code></pre>
<p>The final <em>Program.fs</em> file should look as follows:</p>
<pre><code class="language-fsharp">open System
open Microsoft.ML
open Microsoft.ML.Data

[&lt;CLIMutable&gt;]
type ModelInput = {
    [&lt;LoadColumn(1)&gt;]
    Title:string
    [&lt;LoadColumn(2)&gt;]
    Url:string
    [&lt;LoadColumn(3)&gt;]
    Publisher:string
    [&lt;LoadColumn(4)&gt;]
    Category:string
    [&lt;LoadColumn(6)&gt;]
    Hostname:string
}

[&lt;CLIMutable&gt;]
type ModelOutput = {
    PredictedLabel: string
}

[&lt;EntryPoint&gt;]
let main argv =

    let mlContext = MLContext()

    let data = mlContext.Data.LoadFromTextFile&lt;ModelInput&gt;(&quot;data/newsCorpora.csv&quot;)

    let datasets = mlContext.Data.TrainTestSplit(data,testFraction=0.1)

    let preProcessingPipeline = 
        EstimatorChain()
            .Append(mlContext.Transforms.Text.FeaturizeText(&quot;FeaturizedTitle&quot;,&quot;Title&quot;))
            .Append(mlContext.Transforms.Text.FeaturizeText(&quot;FeaturizedUrl&quot;,&quot;Url&quot;))
            .Append(mlContext.Transforms.Text.FeaturizeText(&quot;FeaturizedPublisher&quot;,&quot;Publisher&quot;))
            .Append(mlContext.Transforms.Text.FeaturizeText(&quot;FeaturizedHost&quot;,&quot;Hostname&quot;))
            .Append(mlContext.Transforms.Concatenate(&quot;Features&quot;,[|&quot;FeaturizedTitle&quot;; &quot;FeaturizedUrl&quot; ;&quot;FeaturizedPublisher&quot;; &quot;FeaturizedHost&quot;|]))
            .Append(mlContext.Transforms.Conversion.MapValueToKey(&quot;Label&quot;,&quot;Category&quot;))

    let algorithm = 
        mlContext.MulticlassClassification.Trainers.LbfgsMaximumEntropy()

    let postProcessingPipeline = 
        mlContext.Transforms.Conversion.MapKeyToValue(&quot;PredictedLabel&quot;)

    let trainingPipeline = 
        preProcessingPipeline
            .Append(algorithm)
            .Append(postProcessingPipeline)

    let model =
        datasets.TrainSet |&gt; trainingPipeline.Fit

    let metrics = 
        (datasets.TestSet |&gt; model.Transform)
        |&gt; mlContext.MulticlassClassification.Evaluate

    printfn &quot;Log Loss: %f | MacroAccuracy: %f&quot; metrics.LogLoss metrics.MacroAccuracy

    let predictions = 
        [
            { 
                Title=&quot;A FIRST LOOK AT SURFACE DUO, MICROSOFT’S FOLDABLE ANDROID PHONE&quot;
                Url=&quot;https://www.theverge.com/2019/10/3/20895268/microsoft-surface-duo-foldable-phone-dual-screen-android-hands-on-features-price-photos-video&quot;
                Publisher=&quot;The Verge&quot;
                Hostname=&quot;www.theverge.com&quot; 
                Category = &quot;&quot; 
            }
            { 
                Title=&quot;This Shrinking Economy With Low Inflation Is Stuck on Rates&quot;
                Url=&quot;https://www.bloomberg.com/news/articles/2019-12-12/when-a-shrinking-economy-and-low-inflation-don-t-mean-rate-cuts?srnd=economics-vp&quot;
                Publisher=&quot;Bloomberg&quot;
                Hostname=&quot;www.bloomberg.com&quot; 
                Category = &quot;&quot; 
            }
        ] 
        |&gt; mlContext.Data.LoadFromEnumerable
        |&gt; model.Transform
 
    mlContext.Data.CreateEnumerable&lt;ModelOutput&gt;(predictions,false)
    |&gt; Seq.iter(fun prediction -&gt; printfn &quot;Predicted Value: %s&quot; prediction.PredictedLabel)

    0 // return an integer exit code
</code></pre>
<h2>Run the application</h2>
<p>This particular model achieved a macro-accuracy of 0.92, where closer to 1 is preferred and log loss of 0.20 where closer to 0 is preferred.</p>
<pre><code class="language-bash">Log Loss: 0.200502 | MacroAccuracy: 0.927742
</code></pre>
<p>The predicted values are the following:</p>
<pre><code class="language-bash">Predicted Value: t
Predicted Value: b
</code></pre>
<p>Upon inspection, they appear to be correct, science and technology for the first link and business for the second link.</p>
<h2>Conclusion</h2>
<p>In this writeup, I showed how to build a machine learning multiclass classification model that categorizes web links using ML.NET. Now that you have a model trained, you can save it and deploy it in another application (desktop, web) that bookmarks links. This model can be further improved and personalized by using data from Pocket which has already been tagged. Happy coding!</p>
</div><footer class="post-footer"><div class="permalink-info">Permalink: <a class="u-url permalink-link" href="/posts/categorize-web-links-ml-net-fsharp-fsadvent2019/">/posts/categorize-web-links-ml-net-fsharp-fsadvent2019/</a></div><div><script type="application/javascript">window.onload = function() { document.getElementById('webmention-target').value = window.location.href }</script><form action="https://webmentions.lqdev.tech/api/inbox" method="POST" enctype="application/x-www-form-urlencoded"><h5 class="text-center">Send me a <a href="/contact">message</a> or <a href="https://indieweb.org/webmentions">webmention</a></h5><div class="form-row justify-content-center"><div class="w-75"><input type="url" class="form-control" name="source" placeholder="Your URL (webmention source)" required /></div><div class="col-auto"><input type="submit" class="btn btn-primary" value="Send" /></div><input type="hidden" readonly name="target" id="webmention-target" /></div></form></div></footer></article></div></div></main><script src="/assets/lib/jquery/jquery.slim.min.js"></script><script src="/assets/lib/boostrap/bootstrap.min.js"></script><script src="/assets/lib/highlight/highlight.min.js"></script><script src="/assets/lib/highlight/highlight.fsharp.min.js"></script><script src="/assets/lib/highlight/highlight.nix.min.js"></script><script src="/assets/js/timeline.js"></script><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script type="application/javascript">mermaid.initialize({startOnLoad:true});</script><script type="application/javascript">hljs.initHighlightingOnLoad();</script><script src="/lib/revealjs/dist/reveal.js"></script><script src="/lib/revealjs/plugin/markdown/markdown.js"></script><script src="/lib/revealjs/plugin/highlight/highlight.js"></script><script type="application/javascript">
                    // Initialize Reveal.js when a presentation container is found on the page
                    document.addEventListener('DOMContentLoaded', function() {
                        const presentationContainer = document.querySelector('.presentation-container');
                        if (presentationContainer && typeof Reveal !== 'undefined') {
                            Reveal.initialize({
                                plugins: [RevealMarkdown, RevealHighlight],
                                embedded: true
                            });
                        }
                    });
                    </script></body><footer><a rel="me" href="https://toot.lqdev.tech/@lqdev"></a><a rel="me" href="https://github.com/lqdev"></a><a rel="me" href="https://twitter.com/ljquintanilla"></a><a rel="me" href="https://www.linkedin.com/in/lquintanilla01/"></a><a rel="me" href="mailto:lqdev@outlook.com"></a></footer></html>